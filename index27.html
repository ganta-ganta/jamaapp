<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JamaApp - Smart Farm Management System</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <!-- Other libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2E7D32;
            --secondary-color: #4CAF50;
            --accent-color: #FF6B35;
            --background-light: #F8F9FA;
            --background-dark: #1A1A1A;
            --text-primary: #212121;
            --text-secondary: #757575;
            --card-bg: #FFFFFF;
            --border-color: #E0E0E0;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #F44336;
            --info-color: #2196F3;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --background-light: #121212;
            --card-bg: #1E1E1E;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0B0;
            --border-color: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--background-light) 0%, #E8F5E8 100%);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
        }

        /* Enhanced Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
        }

        .loading-logo {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
            display: flex;
            align-items: center;
            gap: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .loading-logo i {
            font-size: 4rem;
            animation: rotate 3s linear infinite;
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.5));
        }

        .loading-progress {
            width: 300px;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 2rem 0;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #fff, #81C784, #4CAF50);
            border-radius: 4px;
            animation: loading 4s ease-in-out forwards;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .loading-features {
            margin-top: 3rem;
            text-align: center;
            max-width: 600px;
        }

        .loading-feature {
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards;
            font-size: 1.2rem;
            margin: 0.5rem 0;
            font-weight: 500;
        }

        .loading-feature:nth-child(1) { animation-delay: 0.5s; }
        .loading-feature:nth-child(2) { animation-delay: 1s; }
        .loading-feature:nth-child(3) { animation-delay: 1.5s; }
        .loading-feature:nth-child(4) { animation-delay: 2s; }

        @keyframes loading {
            from { width: 0%; transform: translateX(-100%); }
            to { width: 100%; transform: translateX(0%); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Language Selection Screen */
        .language-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .language-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 3rem;
            border-radius: var(--border-radius);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            text-align: center;
            color: var(--text-primary);
            max-width: 500px;
            width: 90%;
        }

        .language-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .language-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
        }

        .language-options {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .language-option {
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.1rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.5);
        }

        .language-option:hover {
            border-color: var(--primary-color);
            background: rgba(46, 125, 50, 0.1);
            transform: translateY(-2px);
        }

        .language-option.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.1), rgba(76, 175, 80, 0.1));
            box-shadow: 0 0 20px rgba(46, 125, 50, 0.2);
        }

        .flag-icon {
            font-size: 2rem;
        }

        /* Enhanced Authentication Styles */
        .auth-container {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=1200&h=800&fit=crop&crop=center&auto=format&q=60') center/cover;
            opacity: 0.15;
            z-index: 0;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 3rem;
            border-radius: var(--border-radius);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 500px;
            text-align: center;
            position: relative;
            z-index: 1;
            animation: slideInUp 0.6s ease;
        }

        .auth-logo {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .auth-logo i {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(46, 125, 50, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 125, 50, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(46, 125, 50, 0.1);
            border-color: var(--primary-color);
        }

        .btn-google {
            background: linear-gradient(135deg, #DB4437, #C23321);
            color: white;
            width: 100%;
            margin: 0.75rem 0;
        }

        .btn-phone {
            background: linear-gradient(135deg, #0084FF, #0066CC);
            color: white;
            width: 100%;
            margin: 0.75rem 0;
        }

        /* Main App Layout */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        .app-header {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .app-logo {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle, .notification-bell, .profile-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.75rem;
            border-radius: 12px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover, .notification-bell:hover, .profile-btn:hover {
            background: rgba(46, 125, 50, 0.1);
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .main-content {
            display: flex;
            min-height: calc(100vh - 100px);
        }

        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
            backdrop-filter: blur(15px);
            border-right: 1px solid var(--border-color);
            padding: 2rem 0;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .sidebar-nav {
            list-style: none;
            padding: 0 1rem;
        }

        .sidebar-nav li {
            margin: 0.5rem 0;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 1.25rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            border-radius: 12px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .sidebar-nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
            opacity: 0.1;
        }

        .sidebar-nav a:hover::before,
        .sidebar-nav a.active::before {
            width: 100%;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            color: var(--primary-color);
            background: rgba(46, 125, 50, 0.08);
            transform: translateX(8px);
            box-shadow: var(--shadow);
        }

        .sidebar-nav i {
            margin-right: 1rem;
            width: 24px;
            text-align: center;
            font-size: 1.1rem;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: linear-gradient(135deg, #FAFAFA, #F0F8F0);
        }

        /* Enhanced Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card {
            text-align: center;
            padding: 2.5rem;
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 1rem 0;
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .stat-change {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success-color);
            background: rgba(76, 175, 80, 0.15);
        }

        .stat-change.negative {
            color: var(--error-color);
            background: rgba(244, 67, 54, 0.15);
        }

        /* Enhanced Weather Widget */
        .weather-widget {
            background: linear-gradient(135deg, #74b9ff, #0984e3, #00cec9);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        .weather-widget::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=800&h=600&fit=crop&auto=format&q=60') center/cover;
            opacity: 0.2;
            z-index: 0;
        }

        .weather-widget > * {
            position: relative;
            z-index: 1;
        }

        .weather-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.5));
            animation: float 3s ease-in-out infinite;
        }

        .weather-temp {
            font-size: 3.5rem;
            font-weight: 800;
            margin: 1rem 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .weather-desc {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .weather-detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .rain-percentage {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .rain-bar {
            width: 80px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .rain-fill {
            height: 100%;
            background: linear-gradient(90deg, #00cec9, #74b9ff);
            border-radius: 4px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Enhanced Crop Cards */
        .crop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 2rem;
        }

        .crop-card {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
            min-height: 500px;
        }

        .crop-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .crop-card:hover .crop-image {
            transform: scale(1.05);
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .crop-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .crop-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .crop-status.active {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.2));
            color: var(--success-color);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .crop-status.harvested {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
            color: var(--warning-color);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .crop-info {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            display: grid;
            gap: 0.75rem;
        }

        .crop-info div {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            background: rgba(46, 125, 50, 0.05);
            border-radius: 8px;
        }

        .crop-progress {
            margin: 1.5rem 0;
        }

        .crop-progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .progress {
            width: 100%;
            height: 12px;
            background: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin: 0.75rem 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.5s ease;
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(46, 125, 50, 0.3);
        }

        .crop-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.08), rgba(76, 175, 80, 0.05));
            border-radius: 12px;
            border: 1px solid rgba(46, 125, 50, 0.1);
        }

        .metric {
            text-align: center;
            padding: 0.5rem;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .crop-weather-alert {
            background: linear-gradient(135deg, rgba(116, 185, 255, 0.15), rgba(9, 132, 227, 0.1));
            padding: 1rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border-left: 4px solid #74b9ff;
            backdrop-filter: blur(10px);
        }

        .transaction-quick-add {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .transaction-quick-add:hover {
            transform: scale(1.1) rotate(90deg);
            background: #ff5722;
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .related-transactions {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: rgba(255, 107, 53, 0.08);
            border-radius: 12px;
            border-left: 4px solid var(--accent-color);
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 107, 53, 0.1);
            transition: var(--transition);
        }

        .transaction-item:hover {
            background: rgba(255, 107, 53, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin: 0 -1rem;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .crop-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 0.75rem;
            margin-top: 2rem;
        }

        .crop-actions .btn {
            font-size: 0.85rem;
            padding: 0.75rem;
            border-radius: 8px;
        }

        /* Enhanced Transaction Cards */
        .transaction-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            border-left: 4px solid transparent;
            transition: var(--transition);
        }

        .transaction-card.income {
            border-left-color: var(--success-color);
        }

        .transaction-card.expense {
            border-left-color: var(--error-color);
        }

        .transaction-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-hover);
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .transaction-amount {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .transaction-amount.income {
            color: var(--success-color);
        }

        .transaction-amount.expense {
            color: var(--error-color);
        }

        .transaction-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Enhanced Forms and Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius);
            padding: 2.5rem;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.4s ease;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--error-color);
            color: white;
            transform: scale(1.1);
        }

        /* Enhanced Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            box-shadow: var(--shadow);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: linear-gradient(135deg, rgba(46, 125, 50, 0.1), rgba(76, 175, 80, 0.1));
            font-weight: 700;
            color: var(--primary-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tr:hover {
            background: rgba(46, 125, 50, 0.05);
            transform: scale(1.01);
            transition: var(--transition);
        }

        .badge {
            padding: 0.4rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bg-success {
            background: linear-gradient(135deg, var(--success-color), #66bb6a);
            color: white;
        }

        .bg-error {
            background: linear-gradient(135deg, var(--error-color), #e57373);
            color: white;
        }

        .bg-warning {
            background: linear-gradient(135deg, var(--warning-color), #ffb74d);
            color: white;
        }

        .bg-info {
            background: linear-gradient(135deg, var(--info-color), #42a5f5);
            color: white;
        }

        /* Chart Enhancements */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 1.5rem 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(15px);
            box-shadow: var(--shadow);
        }

        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            top: 100px;
            right: 2rem;
            background: var(--success-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            opacity: 0;
            transform: translateY(-20px) translateX(20px);
            transition: var(--transition);
            z-index: 3000;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .auto-save-indicator.show {
            opacity: 1;
            transform: translateY(0) translateX(0);
        }

        .auto-save-indicator.saving {
            background: var(--warning-color);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--border-color);
            padding: 1rem 0.5rem;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 500;
            transition: var(--transition);
            border-radius: 12px;
            min-width: 60px;
        }

        .mobile-nav-item.active,
        .mobile-nav-item:hover {
            color: var(--primary-color);
            background: rgba(46, 125, 50, 0.1);
            transform: translateY(-3px);
        }

        .mobile-nav-item i {
            font-size: 1.4rem;
            margin-bottom: 0.25rem;
        }

        /* Enhanced Floating Action Button */
        .fab {
            position: fixed;
            bottom: 120px;
            right: 2rem;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(46, 125, 50, 0.4);
            transition: var(--transition);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(46, 125, 50, 0.5);
        }

        .fab-menu {
            position: fixed;
            bottom: 210px;
            right: 2rem;
            display: none;
            flex-direction: column;
            gap: 1rem;
            z-index: 998;
        }

        .fab-menu.active {
            display: flex;
            animation: slideInUp 0.3s ease;
        }

        .fab-item {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .fab-item:nth-child(1) { background: var(--success-color); }
        .fab-item:nth-child(2) { background: var(--warning-color); }
        .fab-item:nth-child(3) { background: var(--info-color); }
        .fab-item:nth-child(4) { background: var(--accent-color); }

        .fab-item:hover {
            transform: scale(1.1);
        }

        /* Enhanced Notifications */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 3000;
            animation: slideInRight 0.4s ease;
            max-width: 400px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            backdrop-filter: blur(15px);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success-color), #66bb6a);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--error-color), #e57373);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning-color), #ffb74d);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--info-color), #42a5f5);
        }

        /* Loan Management Styles */
        .loan-card {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 193, 7, 0.05));
            border: 1px solid rgba(255, 152, 0, 0.2);
            border-left: 4px solid var(--warning-color);
        }

        .loan-reminder {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(229, 115, 115, 0.05));
            border: 1px solid rgba(244, 67, 54, 0.2);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
        }

        .emi-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .emi-day {
            padding: 0.5rem;
            text-align: center;
            border-radius: 8px;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .emi-day.due {
            background: var(--error-color);
            color: white;
        }

        .emi-day.paid {
            background: var(--success-color);
            color: white;
        }

        .emi-day.upcoming {
            background: var(--warning-color);
            color: white;
        }

        /* Asset Management Enhancement */
        .asset-card {
            position: relative;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.9));
        }

        .asset-value-card {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(66, 165, 245, 0.05));
            border: 1px solid rgba(33, 150, 243, 0.2);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .mobile-nav {
                display: block;
            }

            .content-area {
                padding: 1.5rem;
                padding-bottom: 120px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .crop-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .fab {
                bottom: 140px;
                right: 1.5rem;
                width: 60px;
                height: 60px;
            }

            .modal-content {
                margin: 1rem;
                padding: 2rem;
                max-height: 85vh;
            }

            .crop-actions {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }

            .crop-metrics {
                grid-template-columns: 1fr 1fr;
            }

            .auth-card {
                padding: 2rem;
                margin: 1rem;
            }

            .weather-details {
                grid-template-columns: 1fr;
            }

            .app-header {
                padding: 1rem 1.5rem;
            }

            .language-card {
                padding: 2rem;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .crop-metrics {
                grid-template-columns: 1fr;
            }

            .auth-card {
                padding: 1.5rem;
            }

            .loading-logo {
                font-size: 2.5rem;
            }

            .fab-menu {
                right: 1.5rem;
            }

            .notification {
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-30px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-success { color: var(--success-color); }
        .text-warning { color: var(--warning-color); }
        .text-error { color: var(--error-color); }
        .text-primary { color: var(--primary-color); }
        .text-secondary { color: var(--text-secondary); }
        
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        
        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .p-3 { padding: 1.5rem; }
        
        .flex { display: flex; }
        .flex-center { display: flex; justify-content: center; align-items: center; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .flex-column { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        
        .grid { display: grid; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        .grid-4 { grid-template-columns: 1fr 1fr 1fr 1fr; }
        
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .hidden { display: none; }
        .block { display: block; }
        
        .rounded { border-radius: 8px; }
        .rounded-lg { border-radius: 12px; }
        .rounded-xl { border-radius: 16px; }
        .rounded-full { border-radius: 50%; }
        
        .shadow { box-shadow: var(--shadow); }
        .shadow-lg { box-shadow: var(--shadow-hover); }
        
        .cursor-pointer { cursor: pointer; }

        /* Enhanced Empty States */
        .empty-state {
            padding: 4rem 2rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            border: 2px dashed var(--border-color);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            opacity: 0.6;
        }

        .empty-state h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .empty-state p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- Enhanced Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-logo">
            <i class="fas fa-seedling"></i>
            JamaApp
        </div>
        <div class="loading-features">
            <div class="loading-feature">🌱 Smart Crop Management</div>
            <div class="loading-feature">💰 Advanced Financial Tracking</div>
            <div class="loading-feature">🌤️ Weather Intelligence & Alerts</div>
            <div class="loading-feature">🚜 Asset & Loan Management</div>
        </div>
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
        <p style="margin-top: 1rem; font-size: 1.1rem;">Initializing your smart farm dashboard...</p>
    </div>

    <!-- Language Selection Screen -->
    <div id="languageSelection" class="language-selection">
        <div class="language-card">
            <div class="language-title">
                <i class="fas fa-seedling"></i> JamaApp
            </div>
            <p class="language-subtitle">Please select your preferred language</p>
            <div class="language-options">
                <div class="language-option" data-lang="en">
                    <div class="flag-icon">🇺🇸</div>
                    <div>
                        <div style="font-weight: 600;">English</div>
                        <div style="font-size: 0.9rem; opacity: 0.7;">Smart Farm Management</div>
                    </div>
                </div>
                <div class="language-option" data-lang="hi">
                    <div class="flag-icon">🇮🇳</div>
                    <div>
                        <div style="font-weight: 600;">हिंदी</div>
                        <div style="font-size: 0.9rem; opacity: 0.7;">स्मार्ट कृषि प्रबंधन</div>
                    </div>
                </div>
                <div class="language-option" data-lang="te">
                    <div class="flag-icon">🇮🇳</div>
                    <div>
                        <div style="font-weight: 600;">తెలుగు</div>
                        <div style="font-size: 0.9rem; opacity: 0.7;">స్మార్ట్ వ్యవసాయ నిర్వహణ</div>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary w-full" onclick="confirmLanguage()">
                <i class="fas fa-check"></i> Continue
            </button>
        </div>
    </div>

    <!-- Authentication Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <div class="auth-logo">
                <i class="fas fa-seedling"></i>
                JamaApp
            </div>
            <p style="margin-bottom: 2rem; color: #666; font-size: 1.2rem; font-weight: 500;" id="authSubtitle">Smart Farm Management System</p>
            
            <!-- Login Form -->
            <div id="loginForm">
                <form id="emailLoginForm">
                    <div class="form-group">
                        <label for="loginEmail" data-translate="email">Email Address</label>
                        <input type="email" id="loginEmail" class="form-control" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword" data-translate="password">Password</label>
                        <input type="password" id="loginPassword" class="form-control" required placeholder="Enter your password">
                    </div>
                    <button type="submit" class="btn btn-primary w-full">
                        <i class="fas fa-sign-in-alt"></i> <span data-translate="signIn">Sign In</span>
                    </button>
                </form>
                
                <div style="margin: 2rem 0; text-align: center; color: #666;">or continue with</div>
                
                <button id="googleSignIn" class="btn btn-google">
                    <i class="fab fa-google"></i> Sign in with Google
                </button>
                
                <button id="phoneSignIn" class="btn btn-phone">
                    <i class="fas fa-phone"></i> Sign in with Phone
                </button>
                
                <p style="margin-top: 2rem; text-align: center;">
                    Don't have an account? 
                    <a href="#" id="showRegister" style="color: var(--primary-color); font-weight: 600;">Register here</a>
                </p>
            </div>

            <!-- Enhanced Registration Form -->
            <div id="registerForm" style="display: none;">
                <form id="emailRegisterForm">
                    <div class="grid grid-2 gap-2">
                        <div class="form-group">
                            <label for="regFirstName" data-translate="firstName">First Name</label>
                            <input type="text" id="regFirstName" class="form-control" required placeholder="First name">
                        </div>
                        <div class="form-group">
                            <label for="regLastName" data-translate="lastName">Last Name</label>
                            <input type="text" id="regLastName" class="form-control" required placeholder="Last name">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="regEmail" data-translate="email">Email Address</label>
                        <input type="email" id="regEmail" class="form-control" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="regPassword" data-translate="password">Password</label>
                        <input type="password" id="regPassword" class="form-control" required placeholder="Create a password">
                    </div>
                    <div class="form-group">
                        <label for="regPhone" data-translate="phone">Phone Number</label>
                        <input type="tel" id="regPhone" class="form-control" required placeholder="+91 XXXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label for="regLocation" data-translate="location">Location</label>
                        <input type="text" id="regLocation" class="form-control" required placeholder="Your location">
                    </div>
                    <div class="grid grid-2 gap-2">
                        <div class="form-group">
                            <label for="regFarmSize" data-translate="farmSize">Farm Size (acres)</label>
                            <input type="number" id="regFarmSize" class="form-control" step="0.1" required placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label for="regPrimaryCrop" data-translate="primaryCrop">Primary Crop</label>
                            <select id="regPrimaryCrop" class="form-control" required>
                                <option value="">Select Primary Crop</option>
                                <option value="rice">🌾 Rice</option>
                                <option value="wheat">🌾 Wheat</option>
                                <option value="corn">🌽 Corn</option>
                                <option value="cotton">🌿 Cotton</option>
                                <option value="sugarcane">🎋 Sugarcane</option>
                                <option value="pulses">🫘 Pulses</option>
                                <option value="vegetables">🥕 Vegetables</option>
                                <option value="fruits">🍎 Fruits</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">
                        <i class="fas fa-user-plus"></i> <span data-translate="createAccount">Create Account</span>
                    </button>
                </form>
                
                <p style="margin-top: 2rem; text-align: center;">
                    Already have an account? 
                    <a href="#" id="showLogin" style="color: var(--primary-color); font-weight: 600;">Sign in here</a>
                </p>
            </div>

            <!-- Phone OTP Form -->
            <div id="otpForm" style="display: none;">
                <div class="form-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input type="tel" id="phoneNumber" class="form-control" placeholder="+91XXXXXXXXXX">
                </div>
                <button id="sendOTP" class="btn btn-primary w-full">
                    <i class="fas fa-paper-plane"></i> Send OTP
                </button>
                
                <div id="otpInput" style="display: none; margin-top: 2rem;">
                    <div class="form-group">
                        <label for="otpCode">Enter 6-digit OTP</label>
                        <input type="text" id="otpCode" class="form-control" maxlength="6" placeholder="123456">
                    </div>
                    <div id="otpTimer" class="text-center" style="margin-bottom: 1rem; color: #666; font-weight: 600;"></div>
                    <button id="verifyOTP" class="btn btn-primary w-full">
                        <i class="fas fa-check"></i> Verify OTP
                    </button>
                    <button id="resendOTP" class="btn btn-secondary w-full" style="margin-top: 1rem;">
                        <i class="fas fa-redo"></i> Resend OTP
                    </button>
                </div>
                
                <p style="margin-top: 1.5rem; text-align: center;">
                    <a href="#" id="backToLogin" style="color: var(--primary-color); font-weight: 600;">← Back to Login</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div id="autoSaveIndicator" class="auto-save-indicator">
        <i class="fas fa-check-circle"></i> Auto-saved
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="app-container">
        <!-- Enhanced Header -->
        <header class="app-header">
            <div class="app-logo">
                <i class="fas fa-seedling"></i>
                JamaApp
            </div>
            <div class="header-actions">
                <div class="language-selector">
                    <select id="languageSelect" class="form-control" style="width: auto; padding: 0.75rem; border-radius: 8px;">
                        <option value="en">🇺🇸 English</option>
                        <option value="hi">🇮🇳 हिंदी</option>
                        <option value="te">🇮🇳 తెలుగు</option>
                    </select>
                </div>
                <button class="notification-bell" id="notificationBell" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span id="notificationCount" class="badge" style="position: absolute; top: -5px; right: -5px; background: var(--error-color); color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 10px;">3</span>
                </button>
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="profile-btn" id="profileBtn" title="Profile menu">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </header>

        <div class="main-content">
            <!-- Enhanced Sidebar Navigation -->
            <nav class="sidebar">
                <ul class="sidebar-nav">
                    <li><a href="#" onclick="showSection('dashboard')" class="active" id="nav-dashboard">
                        <i class="fas fa-chart-line"></i> <span data-translate="dashboard">Dashboard</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('crops')" id="nav-crops">
                        <i class="fas fa-seedling"></i> <span data-translate="crops">Crop Management</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('money')" id="nav-money">
                        <i class="fas fa-coins"></i> <span data-translate="money">Financial Management</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('loans')" id="nav-loans">
                        <i class="fas fa-hand-holding-usd"></i> <span data-translate="loans">Loan Management</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('assets')" id="nav-assets">
                        <i class="fas fa-tractor"></i> <span data-translate="assets">Asset Management</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('ideas')" id="nav-ideas">
                        <i class="fas fa-lightbulb"></i> <span data-translate="ideas">Smart Ideas</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('weather')" id="nav-weather">
                        <i class="fas fa-cloud-sun"></i> <span data-translate="weather">Weather</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('reports')" id="nav-reports">
                        <i class="fas fa-chart-pie"></i> <span data-translate="reports">Reports & Analytics</span>
                    </a></li>
                    <li><a href="#" onclick="showSection('profile')" id="nav-profile">
                        <i class="fas fa-user-cog"></i> <span data-translate="profile">Profile & Settings</span>
                    </a></li>
                </ul>
            </nav>

            <!-- Enhanced Content Area -->
            <main class="content-area">
                <!-- Enhanced Dashboard Section -->
                <div id="dashboard" class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-chart-line" style="margin-right: 1rem;"></i>
                            <span data-translate="farmDashboard">Farm Dashboard</span>
                        </h1>
                        <div style="text-align: right; color: var(--text-secondary);">
                            <div style="font-size: 0.9rem; margin-bottom: 0.25rem;">Last updated</div>
                            <div id="lastUpdated" style="font-weight: 600;">--</div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Financial Summary Cards -->
                    <div class="dashboard-grid">
                        <div class="card stat-card">
                            <i class="fas fa-arrow-trend-up stat-icon text-success"></i>
                            <div class="stat-value" id="totalIncome">₹0</div>
                            <div class="stat-label" data-translate="totalIncome">Total Income</div>
                            <div class="stat-change positive" id="incomeChange">
                                <i class="fas fa-arrow-up"></i> +0% from last month
                            </div>
                        </div>

                        <div class="card stat-card">
                            <i class="fas fa-arrow-trend-down stat-icon text-error"></i>
                            <div class="stat-value" id="totalExpenses">₹0</div>
                            <div class="stat-label" data-translate="totalExpenses">Total Expenses</div>
                            <div class="stat-change negative" id="expenseChange">
                                <i class="fas fa-arrow-down"></i> +0% from last month
                            </div>
                        </div>

                        <div class="card stat-card">
                            <i class="fas fa-chart-line stat-icon text-primary"></i>
                            <div class="stat-value" id="netProfit">₹0</div>
                            <div class="stat-label" data-translate="netProfit">Net Profit</div>
                            <div class="stat-change positive" id="profitChange">
                                <i class="fas fa-percentage"></i> +0% ROI
                            </div>
                        </div>

                        <div class="card stat-card">
                            <i class="fas fa-hand-holding-dollar stat-icon text-warning"></i>
                            <div class="stat-value" id="activeLoans">₹0</div>
                            <div class="stat-label" data-translate="activeLoans">Active Loans</div>
                            <div class="stat-change" id="loanChange">
                                <i class="fas fa-calendar-days"></i> 0 EMIs pending
                            </div>
                        </div>

                        <!-- Enhanced Weather Widget -->
                        <div class="card weather-widget" id="weatherWidget">
                            <div class="weather-icon" id="weatherIcon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="weather-temp" id="weatherTemp">--°C</div>
                            <div class="weather-desc" id="weatherDesc">Loading weather...</div>
                            <div class="rain-percentage">
                                <i class="fas fa-cloud-rain"></i>
                                <span id="weatherRain">--%</span>
                                <div class="rain-bar">
                                    <div class="rain-fill" id="rainFill" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="weather-details">
                                <div class="weather-detail-item">
                                    <i class="fas fa-droplet"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="weatherHumidity">--%</div>
                                        <div style="font-size: 0.8rem;">Humidity</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item">
                                    <i class="fas fa-wind"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="weatherWind">-- km/h</div>
                                        <div style="font-size: 0.8rem;">Wind Speed</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item">
                                    <i class="fas fa-sun"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="weatherUV">--</div>
                                        <div style="font-size: 0.8rem;">UV Index</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item">
                                    <i class="fas fa-temperature-three-quarters"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="weatherFeels">--°C</div>
                                        <div style="font-size: 0.8rem;">Feels Like</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Monthly Insights -->
                        <div class="card">
                            <h3 style="color: var(--primary-color); margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-lightbulb" style="color: var(--accent-color);"></i> Monthly Insights
                            </h3>
                            <div class="insights-grid" style="display: grid; gap: 1.5rem;">
                                <div class="insight-item" style="padding: 1.5rem; background: linear-gradient(135deg, rgba(46, 125, 50, 0.08), rgba(76, 175, 80, 0.05)); border-radius: 12px; border: 1px solid rgba(46, 125, 50, 0.1);">
                                    <div class="insight-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Best Performing Crop</div>
                                    <div class="insight-value text-success" style="font-size: 1.4rem; font-weight: 700;" id="bestCrop">Rice</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">+23% yield increase</div>
                                </div>
                                <div class="insight-item" style="padding: 1.5rem; background: linear-gradient(135deg, rgba(255, 152, 0, 0.08), rgba(255, 193, 7, 0.05)); border-radius: 12px; border: 1px solid rgba(255, 152, 0, 0.1);">
                                    <div class="insight-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Top Expense Category</div>
                                    <div class="insight-value text-warning" style="font-size: 1.4rem; font-weight: 700;" id="highestExpense">Seeds</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">₹15,000 this month</div>
                                </div>
                                <div class="insight-item" style="padding: 1.5rem; background: linear-gradient(135deg, rgba(33, 150, 243, 0.08), rgba(66, 165, 245, 0.05)); border-radius: 12px; border: 1px solid rgba(33, 150, 243, 0.1);">
                                    <div class="insight-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Season ROI</div>
                                    <div class="insight-value" style="font-size: 1.4rem; font-weight: 700; color: #2196f3;" id="roiSeason">15.2%</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">Above average</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="dashboard-grid">
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                <h3 style="color: var(--primary-color); display: flex; align-items: center; gap: 0.75rem; font-size: 1.4rem;">
                                    <i class="fas fa-chart-column"></i> Income vs Expenses
                                </h3>
                                <select id="chartTimeframe" class="form-control" style="width: auto;" onchange="updateChartTimeframe()">
                                    <option value="6months">Last 6 Months</option>
                                    <option value="year">Last Year</option>
                                    <option value="quarter">This Quarter</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="incomeExpenseChart"></canvas>
                            </div>
                        </div>

                        <div class="card">
                            <h3 style="color: var(--primary-color); margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem; font-size: 1.4rem;">
                                <i class="fas fa-chart-pie"></i> Crop Profitability Distribution
                            </h3>
                            <div class="chart-container">
                                <canvas id="cropProfitChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Upcoming Activities & Notifications -->
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3 style="color: var(--primary-color); margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-calendar-check"></i> Upcoming Activities
                            </h3>
                            <div id="upcomingActivities" class="upcoming-activities">
                                <!-- Activities will be loaded here -->
                            </div>
                        </div>

                        <div class="card">
                            <h3 style="color: var(--primary-color); margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-bell"></i> Recent Notifications
                            </h3>
                            <div id="notificationsList" class="notifications-list">
                                <!-- Notifications will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Crop Management Section -->
                <div id="crops" class="section hidden">
                    <div class="flex-between mb-3">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-seedling" style="margin-right: 1rem;"></i>
                            <span data-translate="cropManagement">Crop Management</span>
                        </h1>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="showCropAnalytics()">
                                <i class="fas fa-chart-area"></i> Analytics
                            </button>
                            <button class="btn btn-primary" onclick="showAddCropModal()">
                                <i class="fas fa-plus"></i> <span data-translate="addCrop">Add New Crop</span>
                            </button>
                        </div>
                    </div>

                    <!-- Enhanced Crop Filters -->
                    <div class="card mb-3" style="padding: 1.5rem;">
                        <div class="flex gap-2 flex-wrap" style="align-items: center;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-filter" style="color: var(--primary-color);"></i>
                                <span style="font-weight: 600; color: var(--text-primary);">Filters:</span>
                            </div>
                            <select id="cropStatusFilter" class="form-control" style="width: auto;" onchange="filterCrops()">
                                <option value="">All Status</option>
                                <option value="active">🌱 Active</option>
                                <option value="harvested">🌾 Harvested</option>
                                <option value="planned">📅 Planned</option>
                            </select>
                            <select id="cropSeasonFilter" class="form-control" style="width: auto;" onchange="filterCrops()">
                                <option value="">All Seasons</option>
                                <option value="kharif">🌧️ Kharif (Jun-Oct)</option>
                                <option value="rabi">❄️ Rabi (Nov-Apr)</option>
                                <option value="zaid">☀️ Zaid (May-Jun)</option>
                            </select>
                            <input type="text" id="cropSearchFilter" class="form-control" placeholder="🔍 Search crops..." style="width: 250px;" oninput="filterCrops()">
                            <button class="btn btn-secondary" onclick="clearCropFilters()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>

                    <!-- Crop Statistics Cards -->
                    <div class="dashboard-grid mb-3">
                        <div class="card stat-card">
                            <i class="fas fa-seedling stat-icon text-success"></i>
                            <div class="stat-value" id="activeCropsCount">0</div>
                            <div class="stat-label">Active Crops</div>
                            <div class="stat-change" id="activeCropsChange">
                                <i class="fas fa-leaf"></i> Growing strong
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-chart-area stat-icon text-primary"></i>
                            <div class="stat-value" id="totalCropArea">0</div>
                            <div class="stat-label">Total Area (acres)</div>
                            <div class="stat-change" id="areaUtilization">
                                <i class="fas fa-percentage"></i> 0% utilized
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-calendar-days stat-icon text-warning"></i>
                            <div class="stat-value" id="nearHarvestCount">0</div>
                            <div class="stat-label">Near Harvest</div>
                            <div class="stat-change" id="harvestSchedule">
                                <i class="fas fa-clock"></i> Within 30 days
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Crop Grid -->
                    <div id="cropGrid" class="crop-grid">
                        <!-- Crops will be loaded here -->
                    </div>
                </div>

                <!-- Enhanced Financial Management Section -->
                <div id="money" class="section hidden">
                    <div class="flex-between mb-3">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-coins" style="margin-right: 1rem;"></i>
                            <span data-translate="financialManagement">Financial Management</span>
                        </h1>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="exportFinancialReport()">
                                <i class="fas fa-file-export"></i> Export Report
                            </button>
                            <button class="btn btn-primary" onclick="showAddTransactionModal()">
                                <i class="fas fa-plus"></i> <span data-translate="addTransaction">Add Transaction</span>
                            </button>
                        </div>
                    </div>

                    <!-- Enhanced Financial Summary -->
                    <div class="dashboard-grid mb-3">
                        <div class="card stat-card">
                            <i class="fas fa-arrow-trend-up stat-icon text-success"></i>
                            <div class="stat-value text-success" id="monthlyIncome">₹0</div>
                            <div class="stat-label">This Month Income</div>
                            <div class="stat-change positive" id="monthlyIncomeChange">
                                <i class="fas fa-arrow-up"></i> +0% vs last month
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-arrow-trend-down stat-icon text-error"></i>
                            <div class="stat-value text-error" id="monthlyExpenses">₹0</div>
                            <div class="stat-label">This Month Expenses</div>
                            <div class="stat-change negative" id="monthlyExpensesChange">
                                <i class="fas fa-arrow-down"></i> +0% vs last month
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-balance-scale stat-icon text-primary"></i>
                            <div class="stat-value text-primary" id="monthlyProfit">₹0</div>
                            <div class="stat-label">Monthly Profit</div>
                            <div class="stat-change" id="profitMargin">
                                <i class="fas fa-percentage"></i> 0% margin
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-wallet stat-icon text-info"></i>
                            <div class="stat-value text-info" id="cashFlow">₹0</div>
                            <div class="stat-label">Cash Flow</div>
                            <div class="stat-change" id="cashFlowTrend">
                                <i class="fas fa-chart-line"></i> Stable
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Transaction Filters -->
                    <div class="card mb-3" style="padding: 1.5rem;">
                        <div class="flex gap-2 flex-wrap" style="align-items: center;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-filter" style="color: var(--primary-color);"></i>
                                <span style="font-weight: 600; color: var(--text-primary);">Filters:</span>
                            </div>
                            <select id="transactionTypeFilter" class="form-control" style="width: auto;" onchange="filterTransactions()">
                                <option value="">All Types</option>
                                <option value="income">💰 Income</option>
                                <option value="expense">💳 Expense</option>
                            </select>
                            <select id="transactionCategoryFilter" class="form-control" style="width: auto;" onchange="filterTransactions()">
                                <option value="">All Categories</option>
                                <option value="crop-sale">🌾 Crop Sale</option>
                                <option value="seeds">🌱 Seeds</option>
                                <option value="fertilizers">🧪 Fertilizers</option>
                                <option value="equipment">🚜 Equipment</option>
                                <option value="labor">👨‍🌾 Labor</option>
                                <option value="loan">🏦 Loan</option>
                                <option value="other">📋 Other</option>
                            </select>
                            <input type="text" id="transactionSearchFilter" class="form-control" placeholder="🔍 Search transactions..." style="width: 250px;" oninput="filterTransactions()">
                            <select id="transactionDateFilter" class="form-control" style="width: auto;" onchange="filterTransactions()">
                                <option value="">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                            </select>
                        </div>
                    </div>

                    <!-- Enhanced Transaction Chart -->
                    <div class="card mb-3">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h3 style="color: var(--primary-color); display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-chart-line"></i> Cash Flow Analysis
                            </h3>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary" onclick="toggleChartView('line')">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                                <button class="btn btn-secondary" onclick="toggleChartView('bar')">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                    </div>

                    <!-- Enhanced Transactions Display -->
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h3 style="color: var(--primary-color); display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-list"></i> Recent Transactions
                            </h3>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary" id="viewToggle" onclick="toggleTransactionView()">
                                    <i class="fas fa-table"></i> Table View
                                </button>
                                <button class="btn btn-secondary" onclick="showTransactionSummary()">
                                    <i class="fas fa-chart-pie"></i> Summary
                                </button>
                            </div>
                        </div>
                        
                        <!-- Card View -->
                        <div id="transactionCardsView" style="display: none;">
                            <div id="transactionCards" class="transaction-cards">
                                <!-- Transaction cards will be loaded here -->
                            </div>
                        </div>

                        <!-- Table View -->
                        <div id="transactionTableView" class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-calendar"></i> Date</th>
                                        <th><i class="fas fa-file-alt"></i> Description</th>
                                        <th><i class="fas fa-tags"></i> Category</th>
                                        <th><i class="fas fa-exchange-alt"></i> Type</th>
                                        <th><i class="fas fa-rupee-sign"></i> Amount</th>
                                        <th><i class="fas fa-cog"></i> Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- New Loan Management Section -->
                <div id="loans" class="section hidden">
                    <div class="flex-between mb-3">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-hand-holding-dollar" style="margin-right: 1rem;"></i>
                            <span data-translate="loanManagement">Loan Management</span>
                        </h1>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="showLoanCalculator()">
                                <i class="fas fa-calculator"></i> <span data-translate="loanCalculator">Calculator</span>
                            </button>
                            <button class="btn btn-primary" onclick="showAddLoanModal()">
                                <i class="fas fa-plus"></i> <span data-translate="addLoan">Add Loan</span>
                            </button>
                        </div>
                    </div>

                    <!-- Loan Summary Cards -->
                    <div class="dashboard-grid mb-3">
                        <div class="card stat-card">
                            <i class="fas fa-money-bill-wave stat-icon text-warning"></i>
                            <div class="stat-value" id="totalLoanAmount">₹0</div>
                            <div class="stat-label">Total Loan Amount</div>
                            <div class="stat-change" id="activeLoanCount">
                                <i class="fas fa-list"></i> 0 active loans
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-calendar-check stat-icon text-error"></i>
                            <div class="stat-value" id="monthlyEMITotal">₹0</div>
                            <div class="stat-label">Monthly EMI</div>
                            <div class="stat-change" id="nextEMIDate">
                                <i class="fas fa-clock"></i> Next EMI: --
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-percentage stat-icon text-info"></i>
                            <div class="stat-value" id="avgInterestRate">0%</div>
                            <div class="stat-label">Avg. Interest Rate</div>
                            <div class="stat-change" id="interestPaid">
                                <i class="fas fa-coins"></i> ₹0 paid
                            </div>
                        </div>
                        <div class="card stat-card">
                            <i class="fas fa-chart-pie stat-icon text-success"></i>
                            <div class="stat-value" id="loanCompletion">0%</div>
                            <div class="stat-label">Avg. Completion</div>
                            <div class="stat-change" id="remainingAmount">
                                <i class="fas fa-hourglass-half"></i> ₹0 remaining
                            </div>
                        </div>
                    </div>

                    <!-- EMI Reminder Calendar -->
                    <div class="card mb-3">
                        <h3 style="color: var(--primary-color); margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-calendar-days"></i> EMI Calendar & Reminders
                        </h3>
                        <div id="emiCalendar" class="emi-calendar">
                            <!-- EMI calendar will be loaded here -->
                        </div>
                    </div>

                    <!-- Loan List -->
                    <div class="card">
                        <h3 style="color: var(--primary-color); margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-list"></i> Active Loans
                        </h3>
                        <div id="loansList" class="loans-list">
                            <!-- Loans will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Enhanced Asset Management Section -->
                <div id="assets" class="section hidden">
                    <div class="flex-between mb-3">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-tractor" style="margin-right: 1rem;"></i>
                            <span data-translate="assetManagement">Asset Management</span>
                        </h1>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="showAssetValuation()">
                                <i class="fas fa-chart-bar"></i> Valuation
                            </button>
                            <button class="btn btn-primary" onclick="showAddAssetModal()">
                                <i class="fas fa-plus"></i> <span data-translate="addAsset">Add Asset</span>
                            </button>
                        </div>
                    </div>

                    <!-- Asset Categories Overview -->
                    <div class="dashboard-grid mb-3">
                        <div class="card text-center cursor-pointer" onclick="filterAssets('equipment')">
                            <i class="fas fa-tractor text-primary" style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.8;"></i>
                            <h3 style="margin-bottom: 0.5rem;">Equipment</h3>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <p class="text-secondary" id="equipmentCount">0 items</p>
                                <p class="text-primary" style="font-weight: 700;" id="equipmentValue">₹0</p>
                            </div>
                        </div>
                        <div class="card text-center cursor-pointer" onclick="filterAssets('livestock')">
                            <i class="fas fa-cow text-primary" style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.8;"></i>
                            <h3 style="margin-bottom: 0.5rem;">Livestock</h3>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <p class="text-secondary" id="livestockCount">0 animals</p>
                                <p class="text-primary" style="font-weight: 700;" id="livestockValue">₹0</p>
                            </div>
                        </div>
                        <div class="card text-center cursor-pointer" onclick="filterAssets('land')">
                            <i class="fas fa-map text-primary" style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.8;"></i>
                            <h3 style="margin-bottom: 0.5rem;">Land</h3>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <p class="text-secondary" id="landCount">0 plots</p>
                                <p class="text-primary" style="font-weight: 700;" id="landValue">₹0</p>
                            </div>
                        </div>
                        <div class="card text-center cursor-pointer" onclick="filterAssets('inventory')">
                            <i class="fas fa-boxes text-primary" style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.8;"></i>
                            <h3 style="margin-bottom: 0.5rem;">Inventory</h3>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <p class="text-secondary" id="inventoryCount">0 items</p>
                                <p class="text-primary" style="font-weight: 700;" id="inventoryValue">₹0</p>
                            </div>
                        </div>
                    </div>

                    <!-- Asset List -->
                    <div id="assetsList" class="crop-grid">
                        <!-- Assets will be loaded here -->
                    </div>
                </div>

                <!-- Enhanced Smart Ideas Section -->
                <div id="ideas" class="section hidden">
                    <div class="flex-between mb-3">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-lightbulb" style="margin-right: 1rem; color: var(--accent-color);"></i>
                            <span data-translate="smartIdeas">Smart Farming Ideas</span>
                        </h1>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="showPersonalizedIdeas()">
                                <i class="fas fa-user"></i> Personalized
                            </button>
                            <button class="btn btn-primary" onclick="refreshIdeas()">
                                <i class="fas fa-sync-alt"></i> <span data-translate="refreshIdeas">Refresh Ideas</span>
                            </button>
                        </div>
                    </div>

                    <!-- Ideas Categories -->
                    <div class="card mb-3" style="padding: 1.5rem;">
                        <div class="flex gap-2 flex-wrap">
                            <button class="btn btn-secondary active" onclick="filterIdeas('all')">
                                <i class="fas fa-star"></i> All Ideas
                            </button>
                            <button class="btn btn-secondary" onclick="filterIdeas('crop')">
                                <i class="fas fa-seedling"></i> Crop
                            </button>
                            <button class="btn btn-secondary" onclick="filterIdeas('financial')">
                                <i class="fas fa-coins"></i> Financial
                            </button>
                            <button class="btn btn-secondary" onclick="filterIdeas('technology')">
                                <i class="fas fa-microchip"></i> Technology
                            </button>
                            <button class="btn btn-secondary" onclick="filterIdeas('market')">
                                <i class="fas fa-chart-trending-up"></i> Market
                            </button>
                            <button class="btn btn-secondary" onclick="filterIdeas('sustainability')">
                                <i class="fas fa-leaf"></i> Sustainability
                            </button>
                        </div>
                    </div>

                    <!-- Ideas Grid -->
                    <div id="ideasGrid" class="crop-grid">
                        <!-- Ideas will be loaded here -->
                    </div>
                </div>

                <!-- Enhanced Weather Section -->
                <div id="weather" class="section hidden">
                    <div class="flex-between mb-3">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-cloud-sun" style="margin-right: 1rem;"></i>
                            <span data-translate="weatherInformation">Weather Information</span>
                        </h1>
                        <button class="btn btn-primary" onclick="refreshWeatherData()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <!-- Location Input -->
                    <div class="card mb-3" style="padding: 1.5rem;">
                        <div class="flex gap-2">
                            <div style="position: relative; flex: 1;">
                                <i class="fas fa-location-dot" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></i>
                                <input type="text" id="weatherLocation" class="form-control" placeholder="🌍 Enter location (e.g., Delhi, India)" style="padding-left: 3rem;">
                            </div>
                            <button class="btn btn-primary" onclick="getWeatherByLocation()">
                                <i class="fas fa-search"></i> Get Weather
                            </button>
                            <button class="btn btn-secondary" onclick="getCurrentLocationWeather()">
                                <i class="fas fa-location-crosshairs"></i> Current Location
                            </button>
                        </div>
                    </div>

                    <!-- Current Weather Display -->
                    <div class="dashboard-grid mb-3">
                        <div class="card weather-widget" style="grid-column: span 2;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem;">
                                <div>
                                    <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <i class="fas fa-thermometer-half"></i> Current Weather
                                    </h3>
                                    <div id="currentWeatherLocation" style="font-size: 1.1rem; opacity: 0.9;">Delhi, India</div>
                                </div>
                                <div id="currentWeatherTime" style="font-size: 0.9rem; opacity: 0.8;">Updated: --</div>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem;">
                                <div class="weather-icon">
                                    <i id="currentWeatherIcon" class="fas fa-sun"></i>
                                </div>
                                <div>
                                    <div class="weather-temp" id="currentTemp">--°C</div>
                                    <div class="weather-desc" id="currentDesc">--</div>
                                </div>
                            </div>
                            
                            <div class="weather-details">
                                <div class="weather-detail-item">
                                    <i class="fas fa-temperature-arrow-up"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="feelsLike">--°C</div>
                                        <div style="font-size: 0.8rem;">Feels Like</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item">
                                    <i class="fas fa-droplet"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="currentHumidity">--%</div>
                                        <div style="font-size: 0.8rem;">Humidity</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item">
                                    <i class="fas fa-wind"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="currentWind">-- km/h</div>
                                        <div style="font-size: 0.8rem;">Wind Speed</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item">
                                    <i class="fas fa-gauge"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="currentPressure">-- hPa</div>
                                        <div style="font-size: 0.8rem;">Pressure</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-seedling"></i> Agricultural Conditions
                            </h3>
                            <div class="weather-details" style="grid-template-columns: 1fr;">
                                <div class="weather-detail-item" style="padding: 1rem;">
                                    <i class="fas fa-sun" style="color: var(--warning-color);"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="uvIndex">--</div>
                                        <div style="font-size: 0.8rem;">UV Index</div>
                                        <div id="uvAdvice" style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.25rem;">--</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item" style="padding: 1rem;">
                                    <i class="fas fa-thermometer-quarter" style="color: var(--info-color);"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="soilTemp">--°C</div>
                                        <div style="font-size: 0.8rem;">Soil Temperature</div>
                                    </div>
                                </div>
                                <div class="weather-detail-item" style="padding: 1rem;">
                                    <div style="width: 100%;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                            <span style="font-size: 0.8rem;">Rain Chance</span>
                                            <span style="font-weight: 600;" id="rainChance">--%</span>
                                        </div>
                                        <div class="rain-bar" style="width: 100%; margin-top: 0.5rem;">
                                            <div class="rain-fill" id="rainChanceFill" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="weather-detail-item" style="padding: 1rem;">
                                    <i class="fas fa-eye"></i>
                                    <div>
                                        <div style="font-weight: 600;" id="visibility">-- km</div>
                                        <div style="font-size: 0.8rem;">Visibility</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-triangle-exclamation"></i> Farming Alerts
                            </h3>
                            <div id="farmingAlerts" class="farming-alerts">
                                <!-- Alerts will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- 7-Day Forecast -->
                    <div class="card mb-3">
                        <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                            <i class="fas fa-calendar-week"></i> 7-Day Forecast
                        </h3>
                        <div id="weatherForecast" class="weather-forecast" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                            <!-- Forecast will be populated here -->
                        </div>
                    </div>

                    <!-- Weather Analytics -->
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-chart-line"></i> 24-Hour Temperature Trend
                            </h3>
                            <div class="chart-container">
                                <canvas id="temperatureChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-cloud-rain"></i> Precipitation Forecast
                            </h3>
                            <div class="chart-container">
                                <canvas id="precipitationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Reports & Analytics Section -->
                <div id="reports" class="section hidden">
                    <div class="flex-between mb-3">
                        <h1 style="color: var(--primary-color); font-size: 2.5rem; font-weight: 800;">
                            <i class="fas fa-chart-pie" style="margin-right: 1rem;"></i>
                            <span data-translate="reportsAnalytics">Reports & Analytics</span>
                        </h1>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="scheduleReport()">
                                <i class="fas fa-clock"></i> Schedule
                            </button>
                            <button class="btn btn-primary" onclick="exportAllData()">
                                <i class="fas fa-download"></i> Export Report
                            </button>
                        </div>
                    </div>

                    <!-- Report Types -->
                    <div class="dashboard-grid mb-3">
                        <div class="card cursor-pointer" onclick="generateReport('financial')">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-bar" style="font-size: 3rem; color: var(--success-color); margin-bottom: 1rem;"></i>
                                <h3>Financial Report</h3>
                                <p style="color: var(--text-secondary);">Income, expenses, and profit analysis</p>
                            </div>
                        </div>
                        <div class="card cursor-pointer" onclick="generateReport('crop')">
                            <div style="text-align: center;">
                                <i class="fas fa-seedling" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                                <h3>Crop Report</h3>
                                <p style="color: var(--text-secondary);">Yield, performance, and growth analysis</p>
                            </div>
                        </div>
                        <div class="card cursor-pointer" onclick="generateReport('asset')">
                            <div style="text-align: center;">
                                <i class="fas fa-tractor" style="font-size: 3rem; color: var(--info-color); margin-bottom: 1rem;"></i>
                                <h3>Asset Report</h3>
                                <p style="color: var(--text-secondary);">Asset valuation and depreciation</p>
                            </div>
                        </div>
                        <div class="card cursor-pointer" onclick="generateReport('comprehensive')">
                            <div style="text-align: center;">
                                <i class="fas fa-file-contract" style="font-size: 3rem; color: var(--accent-color); margin-bottom: 1rem;"></i>
                                <h3>Comprehensive Report</h3>
                                <p style="color: var(--text-secondary);">Complete farm analysis and insights</p>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Dashboard -->
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3 style="color: var(--primary-color); margin-bottom: 2rem;">Monthly Performance</h3>
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 style="color: var(--primary-color); margin-bottom: 2rem;">ROI Analysis</h3>
                            <div class="chart-container">
                                <canvas id="roiChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Profile & Settings Section -->
                <div id="profile" class="section hidden">
                    <h1 style="color: var(--primary-color); margin-bottom: 2rem; font-size: 2.5rem; font-weight: 800;">
                        <i class="fas fa-user-cog" style="margin-right: 1rem;"></i>
                        <span data-translate="profileSettings">Profile & Settings</span>
                    </h1>
                    
                    <div class="dashboard-grid">
                        <!-- Enhanced Profile Information -->
                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-user"></i> Profile Information
                            </h3>
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div id="profileDisplayName" style="font-size: 1.4rem; font-weight: 700; color: var(--primary-color);">--</div>
                                <div id="profileDisplayEmail" style="color: var(--text-secondary);">--</div>
                            </div>
                            <form id="profileForm">
                                <div class="form-group">
                                    <label for="profileName" data-translate="fullName">Full Name</label>
                                    <input type="text" id="profileName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="profileEmail" data-translate="email">Email</label>
                                    <input type="email" id="profileEmail" class="form-control" readonly style="background: var(--border-color); opacity: 0.7;">
                                </div>
                                <div class="form-group">
                                    <label for="profilePhone" data-translate="phone">Phone</label>
                                    <input type="tel" id="profilePhone" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="profileLocation" data-translate="location">Location</label>
                                    <input type="text" id="profileLocation" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="profileFarmSize" data-translate="farmSize">Farm Size (acres)</label>
                                    <input type="number" id="profileFarmSize" class="form-control" step="0.1">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> <span data-translate="updateProfile">Update Profile</span>
                                </button>
                            </form>
                        </div>

                        <!-- Enhanced Farm Statistics -->
                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-chart-bar"></i> Farm Statistics
                            </h3>
                            <div class="stats-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                                <div class="stat-item" style="text-align: center; padding: 1.5rem; background: linear-gradient(135deg, rgba(46, 125, 50, 0.08), rgba(76, 175, 80, 0.05)); border-radius: 12px; border: 1px solid rgba(46, 125, 50, 0.1);">
                                    <div class="stat-icon" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;">🌾</div>
                                    <div class="stat-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Total Crops</div>
                                    <div class="stat-value" style="font-size: 1.8rem; font-weight: 700; color: var(--primary-color);" id="statTotalCrops">0</div>
                                </div>
                                <div class="stat-item" style="text-align: center; padding: 1.5rem; background: linear-gradient(135deg, rgba(76, 175, 80, 0.08), rgba(139, 195, 74, 0.05)); border-radius: 12px; border: 1px solid rgba(76, 175, 80, 0.1);">
                                    <div class="stat-icon" style="font-size: 2rem; color: var(--success-color); margin-bottom: 0.5rem;">🌱</div>
                                    <div class="stat-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Active Crops</div>
                                    <div class="stat-value" style="font-size: 1.8rem; font-weight: 700; color: var(--success-color);" id="statActiveCrops">0</div>
                                </div>
                                <div class="stat-item" style="text-align: center; padding: 1.5rem; background: linear-gradient(135deg, rgba(255, 152, 0, 0.08), rgba(255, 193, 7, 0.05)); border-radius: 12px; border: 1px solid rgba(255, 152, 0, 0.1);">
                                    <div class="stat-icon" style="font-size: 2rem; color: var(--warning-color); margin-bottom: 0.5rem;">💰</div>
                                    <div class="stat-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Transactions</div>
                                    <div class="stat-value" style="font-size: 1.8rem; font-weight: 700; color: var(--warning-color);" id="statTotalTransactions">0</div>
                                </div>
                                <div class="stat-item" style="text-align: center; padding: 1.5rem; background: linear-gradient(135deg, rgba(33, 150, 243, 0.08), rgba(66, 165, 245, 0.05)); border-radius: 12px; border: 1px solid rgba(33, 150, 243, 0.1);">
                                    <div class="stat-icon" style="font-size: 2rem; color: #2196f3; margin-bottom: 0.5rem;">🚜</div>
                                    <div class="stat-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Assets</div>
                                    <div class="stat-value" style="font-size: 1.8rem; font-weight: 700; color: #2196f3;" id="statTotalAssets">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced App Settings -->
                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-cog"></i> App Settings
                            </h3>
                            <div class="form-group">
                                <label data-translate="theme">Theme Preference</label>
                                <div class="flex gap-2" style="margin-top: 0.5rem;">
                                    <button class="btn btn-secondary" onclick="setTheme('light')" id="lightThemeBtn">
                                        <i class="fas fa-sun"></i> Light
                                    </button>
                                    <button class="btn btn-secondary" onclick="setTheme('dark')" id="darkThemeBtn">
                                        <i class="fas fa-moon"></i> Dark
                                    </button>
                                    <button class="btn btn-secondary" onclick="setTheme('auto')" id="autoThemeBtn">
                                        <i class="fas fa-circle-half-stroke"></i> Auto
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="settingsLanguage" data-translate="language">Language</label>
                                <select id="settingsLanguage" class="form-control" onchange="changeLanguage(this.value)">
                                    <option value="en">🇺🇸 English</option>
                                    <option value="hi">🇮🇳 हिंदी</option>
                                    <option value="te">🇮🇳 తెలుగు</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label data-translate="notifications">Notification Settings</label>
                                <div style="margin-top: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                        <input type="checkbox" id="notifHarvest" checked>
                                        <span>Harvest reminders</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                        <input type="checkbox" id="notifWeather" checked>
                                        <span>Weather alerts</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                        <input type="checkbox" id="notifLoans" checked>
                                        <span>EMI reminders</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.75rem;">
                                        <input type="checkbox" id="notifReports" checked>
                                        <span>Monthly reports</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Data Management -->
                        <div class="card">
                            <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                                <i class="fas fa-database"></i> Data Management
                            </h3>
                            <div class="flex-column gap-2">
                                <button class="btn btn-primary" onclick="exportAllData()">
                                    <i class="fas fa-file-pdf"></i> Export Complete Report (PDF)
                                </button>
                                <button class="btn btn-secondary" onclick="exportExcelReport()">
                                    <i class="fas fa-file-excel"></i> Export to Excel
                                </button>
                                <button class="btn btn-secondary" onclick="backupData()">
                                    <i class="fas fa-cloud-upload-alt"></i> Backup to Cloud
                                </button>
                                <button class="btn btn-secondary" onclick="importData()">
                                    <i class="fas fa-cloud-download-alt"></i> Import Data
                                </button>
                                <hr style="margin: 1rem 0;">
                                <button class="btn" style="background: var(--error-color); color: white;" onclick="clearAllData()">
                                    <i class="fas fa-trash"></i> Clear All Data
                                </button>
                                <button class="btn" style="background: var(--error-color); color: white;" onclick="signOut()">
                                    <i class="fas fa-sign-out-alt"></i> Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Enhanced Mobile Navigation -->
        <nav class="mobile-nav">
            <div class="mobile-nav-items">
                <a href="#" onclick="showSection('dashboard')" class="mobile-nav-item active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span data-translate="dashboard">Dashboard</span>
                </a>
                <a href="#" onclick="showSection('crops')" class="mobile-nav-item" data-section="crops">
                    <i class="fas fa-seedling"></i>
                    <span data-translate="crops">Crops</span>
                </a>
                <a href="#" onclick="showSection('money')" class="mobile-nav-item" data-section="money">
                    <i class="fas fa-coins"></i>
                    <span data-translate="money">Money</span>
                </a>
                <a href="#" onclick="showSection('assets')" class="mobile-nav-item" data-section="assets">
                    <i class="fas fa-tractor"></i>
                    <span data-translate="assets">Assets</span>
                </a>
                <a href="#" onclick="showSection('profile')" class="mobile-nav-item" data-section="profile">
                    <i class="fas fa-user"></i>
                    <span data-translate="profile">Profile</span>
                </a>
            </div>
        </nav>

        <!-- Enhanced Floating Action Button with Menu -->
        <button class="fab" id="fabButton" onclick="toggleFabMenu()">
            <i class="fas fa-plus"></i>
        </button>
        
        <div class="fab-menu" id="fabMenu">
            <button class="fab-item" onclick="showAddCropModal(); toggleFabMenu();" title="Add Crop">
                <i class="fas fa-seedling"></i>
            </button>
            <button class="fab-item" onclick="showAddTransactionModal(); toggleFabMenu();" title="Add Transaction">
                <i class="fas fa-coins"></i>
            </button>
            <button class="fab-item" onclick="showSection('weather'); toggleFabMenu();" title="Check Weather">
                <i class="fas fa-cloud-sun"></i>
            </button>
            <button class="fab-item" onclick="showAddAssetModal(); toggleFabMenu();" title="Add Asset">
                <i class="fas fa-tractor"></i>
            </button>
        </div>
    </div>

    <!-- Enhanced Modals -->
    <!-- Add Crop Modal -->
    <div id="addCropModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-seedling"></i> <span data-translate="addNewCrop">Add New Crop</span>
                </h2>
                <button class="close-modal" onclick="closeModal('addCropModal')">&times;</button>
            </div>
            <form id="addCropForm">
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="cropName" data-translate="cropName">Crop Name</label>
                        <select id="cropName" class="form-control" required onchange="updateCropVarieties()">
                            <option value="">Select Crop</option>
                            <option value="rice">🌾 Rice</option>
                            <option value="wheat">🌾 Wheat</option>
                            <option value="corn">🌽 Corn/Maize</option>
                            <option value="cotton">🌿 Cotton</option>
                            <option value="sugarcane">🎋 Sugarcane</option>
                            <option value="pulses">🫘 Pulses</option>
                            <option value="vegetables">🥕 Vegetables</option>
                            <option value="fruits">🍎 Fruits</option>
                            <option value="spices">🌶️ Spices</option>
                            <option value="oilseeds">🌻 Oilseeds</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cropVariety" data-translate="variety">Variety</label>
                        <select id="cropVariety" class="form-control">
                            <option value="">Select Variety</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-3 gap-2">
                    <div class="form-group">
                        <label for="cropArea" data-translate="area">Area (acres)</label>
                        <input type="number" id="cropArea" class="form-control" step="0.1" required placeholder="0.0" onchange="calculateExpectedRevenue()">
                    </div>
                    <div class="form-group">
                        <label for="cropSeason" data-translate="season">Season</label>
                        <select id="cropSeason" class="form-control" required>
                            <option value="">Select Season</option>
                            <option value="kharif">🌧️ Kharif (Jun-Oct)</option>
                            <option value="rabi">❄️ Rabi (Nov-Apr)</option>
                            <option value="zaid">☀️ Zaid (May-Jun)</option>
                            <option value="perennial">🔄 Perennial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cropLocation" data-translate="location">Location/Field</label>
                        <input type="text" id="cropLocation" class="form-control" placeholder="Field location">
                    </div>
                </div>
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="sowingDate" data-translate="sowingDate">Sowing Date</label>
                        <input type="date" id="sowingDate" class="form-control" required onchange="calculateHarvestDate()">
                    </div>
                    <div class="form-group">
                        <label for="expectedHarvest" data-translate="expectedHarvest">Expected Harvest Date</label>
                        <input type="date" id="expectedHarvest" class="form-control" required>
                    </div>
                </div>
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="expectedYield" data-translate="expectedYield">Expected Yield (tons)</label>
                        <input type="number" id="expectedYield" class="form-control" step="0.1" placeholder="0.0" onchange="calculateExpectedRevenue()">
                    </div>
                    <div class="form-group">
                        <label for="expectedPrice" data-translate="expectedPrice">Expected Price (₹/ton)</label>
                        <input type="number" id="expectedPrice" class="form-control" placeholder="0" onchange="calculateExpectedRevenue()">
                    </div>
                </div>
                <div class="form-group">
                    <label>Expected Revenue</label>
                    <div id="expectedRevenue" style="font-size: 1.2rem; font-weight: 700; color: var(--success-color); padding: 0.75rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">₹0</div>
                </div>
                <div class="form-group">
                    <label for="cropNotes" data-translate="notes">Notes</label>
                    <textarea id="cropNotes" class="form-control" rows="3" placeholder="Additional notes about this crop..."></textarea>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> <span data-translate="addCrop">Add Crop</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addCropModal')">
                        <i class="fas fa-times"></i> <span data-translate="cancel">Cancel</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Enhanced Add Transaction Modal -->
    <div id="addTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-plus-circle"></i> <span data-translate="addTransaction">Add Transaction</span>
                </h2>
                <button class="close-modal" onclick="closeModal('addTransactionModal')">&times;</button>
            </div>
            <form id="addTransactionForm">
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="transactionType" data-translate="type">Type</label>
                        <select id="transactionType" class="form-control" required onchange="updateTransactionCategories()">
                            <option value="">Select Type</option>
                            <option value="income">💰 Income</option>
                            <option value="expense">💳 Expense</option>
                            <option value="loan-taken">🏦 Loan Taken</option>
                            <option value="loan-given">🤝 Loan Given</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionCategory" data-translate="category">Category</label>
                        <select id="transactionCategory" class="form-control" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transactionDescription" data-translate="description">Description</label>
                    <input type="text" id="transactionDescription" class="form-control" required placeholder="Brief description">
                </div>
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="transactionAmount" data-translate="amount">Amount (₹)</label>
                        <input type="number" id="transactionAmount" class="form-control" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="transactionDate" data-translate="date">Date</label>
                        <input type="date" id="transactionDate" class="form-control" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transactionPaymentMethod" data-translate="paymentMethod">Payment Method</label>
                    <select id="transactionPaymentMethod" class="form-control">
                        <option value="cash">💵 Cash</option>
                        <option value="bank_transfer">🏦 Bank Transfer</option>
                        <option value="check">📄 Check</option>
                        <option value="digital">📱 Digital Payment (UPI/Cards)</option>
                        <option value="credit">💳 Credit</option>
                    </select>
                </div>
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="transactionCropId" data-translate="relatedCrop">Related Crop (optional)</label>
                        <select id="transactionCropId" class="form-control">
                            <option value="">Select Crop</option>
                            <!-- Crops will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionAssetId" data-translate="relatedAsset">Related Asset (optional)</label>
                        <select id="transactionAssetId" class="form-control">
                            <option value="">Select Asset</option>
                            <!-- Assets will be loaded dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group" id="loanDetailsSection" style="display: none;">
                    <label>Loan Details</label>
                    <div class="grid grid-2 gap-2">
                        <input type="number" id="loanInterestRate" class="form-control" placeholder="Interest Rate %" step="0.1">
                        <input type="number" id="loanTenure" class="form-control" placeholder="Tenure (months)">
                    </div>
                </div>
                <div class="form-group">
                    <label for="transactionNotes" data-translate="notes">Notes</label>
                    <textarea id="transactionNotes" class="form-control" rows="2" placeholder="Additional notes..."></textarea>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> <span data-translate="addTransaction">Add Transaction</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addTransactionModal')">
                        <i class="fas fa-times"></i> <span data-translate="cancel">Cancel</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Enhanced Loan Calculator Modal -->
    <div id="loanCalculatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-calculator"></i> <span data-translate="loanCalculator">Loan Calculator</span>
                </h2>
                <button class="close-modal" onclick="closeModal('loanCalculatorModal')">&times;</button>
            </div>
            <div class="grid grid-2 gap-3">
                <div>
                    <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                        <i class="fas fa-file-invoice-dollar"></i> Loan Details
                    </h3>
                    <div class="form-group">
                        <label for="loanPrincipal">Principal Amount (₹)</label>
                        <input type="number" id="loanPrincipal" class="form-control" oninput="calculateLoan()" placeholder="100000">
                    </div>
                    <div class="form-group">
                        <label for="loanRate">Interest Rate (% per annum)</label>
                        <input type="number" id="loanRate" class="form-control" step="0.1" oninput="calculateLoan()" placeholder="12.0">
                    </div>
                    <div class="form-group">
                        <label for="loanTerm">Loan Term (months)</label>
                        <input type="number" id="loanTerm" class="form-control" oninput="calculateLoan()" placeholder="12">
                    </div>
                    <div class="form-group">
                        <label for="loanType">Interest Type</label>
                        <select id="loanType" class="form-control" onchange="calculateLoan()">
                            <option value="reducing">Reducing Balance (EMI)</option>
                            <option value="simple">Simple Interest</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="loanPurpose">Loan Purpose</label>
                        <select id="loanPurpose" class="form-control">
                            <option value="crop_loan">🌾 Crop Loan</option>
                            <option value="equipment_loan">🚜 Equipment Loan</option>
                            <option value="land_purchase">🏞️ Land Purchase</option>
                            <option value="irrigation">💧 Irrigation Setup</option>
                            <option value="working_capital">💼 Working Capital</option>
                            <option value="personal">👤 Personal</option>
                            <option value="other">📋 Other</option>
                        </select>
                    </div>
                </div>
                <div>
                    <h3 style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem;">
                        <i class="fas fa-chart-bar"></i> Calculation Results
                    </h3>
                    <div class="loan-results" style="display: grid; gap: 1.5rem;">
                        <div class="result-item" style="padding: 1.5rem; background: linear-gradient(135deg, rgba(46, 125, 50, 0.08), rgba(76, 175, 80, 0.05)); border-radius: 12px; text-align: center; border: 1px solid rgba(46, 125, 50, 0.1);">
                            <div class="result-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Monthly EMI</div>
                            <div class="result-value" style="font-size: 1.8rem; font-weight: 700; color: var(--primary-color);" id="monthlyEMI">₹0</div>
                        </div>
                        <div class="result-item" style="padding: 1.5rem; background: linear-gradient(135deg, rgba(255, 152, 0, 0.08), rgba(255, 193, 7, 0.05)); border-radius: 12px; text-align: center; border: 1px solid rgba(255, 152, 0, 0.1);">
                            <div class="result-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Total Interest</div>
                            <div class="result-value" style="font-size: 1.8rem; font-weight: 700; color: var(--warning-color);" id="totalInterest">₹0</div>
                        </div>
                        <div class="result-item" style="padding: 1.5rem; background: linear-gradient(135deg, rgba(33, 150, 243, 0.08), rgba(66, 165, 245, 0.05)); border-radius: 12px; text-align: center; border: 1px solid rgba(33, 150, 243, 0.1);">
                            <div class="result-label" style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Total Amount</div>
                            <div class="result-value" style="font-size: 1.8rem; font-weight: 700; color: #2196f3;" id="totalAmount">₹0</div>
                        </div>
                        <div style="padding: 1rem; background: rgba(244, 67, 54, 0.08); border-radius: 12px; border: 1px solid rgba(244, 67, 54, 0.1);">
                            <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">EMI to Income Ratio</div>
                            <div id="emiRatio" style="font-size: 1.2rem; font-weight: 600; color: var(--error-color);">--</div>
                            <div id="ratioAdvice" style="font-size: 0.8rem; margin-top: 0.25rem; color: var(--text-secondary);">--</div>
                        </div>
                    </div>
                    <button class="btn btn-primary w-full" style="margin-top: 2rem;" onclick="saveLoan()">
                        <i class="fas fa-save"></i> <span data-translate="saveLoan">Save Loan</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Add Asset Modal -->
    <div id="addAssetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-plus-square"></i> <span data-translate="addAsset">Add Asset</span>
                </h2>
                <button class="close-modal" onclick="closeModal('addAssetModal')">&times;</button>
            </div>
            <form id="addAssetForm">
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="assetType" data-translate="assetType">Asset Type</label>
                        <select id="assetType" class="form-control" required onchange="updateAssetFields()">
                            <option value="">Select Type</option>
                            <option value="equipment">🚜 Equipment</option>
                            <option value="livestock">🐄 Livestock</option>
                            <option value="land">🌾 Land</option>
                            <option value="inventory">📦 Inventory</option>
                            <option value="vehicle">🚗 Vehicle</option>
                            <option value="infrastructure">🏗️ Infrastructure</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assetName" data-translate="assetName">Asset Name</label>
                        <input type="text" id="assetName" class="form-control" required placeholder="Asset name">
                    </div>
                </div>
                <div class="grid grid-2 gap-2">
                    <div class="form-group">
                        <label for="assetPurchaseDate" data-translate="purchaseDate">Purchase Date</label>
                        <input type="date" id="assetPurchaseDate" class="form-control" onchange="calculateAssetAge()">
                    </div>
                    <div class="form-group">
                        <label for="assetPurchasePrice" data-translate="purchasePrice">Purchase Price (₹)</label>
                        <input type="number" id="assetPurchasePrice" class="form-control" step="0.01" placeholder="0.00" onchange="calculateDepreciation()">
                    </div>
                </div>
                
                <!-- Equipment Fields -->
                <div id="equipmentFields" class="hidden">
                    <div class="grid grid-3 gap-2">
                        <div class="form-group">
                            <label for="equipmentCondition">Condition</label>
                            <select id="equipmentCondition" class="form-control">
                                <option value="excellent">⭐ Excellent</option>
                                <option value="good">👍 Good</option>
                                <option value="fair">🆗 Fair</option>
                                <option value="poor">👎 Poor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="equipmentBrand">Brand/Model</label>
                            <input type="text" id="equipmentBrand" class="form-control" placeholder="Brand/Model">
                        </div>
                        <div class="form-group">
                            <label for="equipmentMaintenanceCost">Annual Maintenance (₹)</label>
                            <input type="number" id="equipmentMaintenanceCost" class="form-control" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                </div>

                <!-- Livestock Fields -->
                <div id="livestockFields" class="hidden">
                    <div class="grid grid-4 gap-2">
                        <div class="form-group">
                            <label for="animalCount">Count</label>
                            <input type="number" id="animalCount" class="form-control" placeholder="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="animalBreed">Breed</label>
                            <input type="text" id="animalBreed" class="form-control" placeholder="Animal breed">
                        </div>
                        <div class="form-group">
                            <label for="animalAge">Age (months)</label>
                            <input type="number" id="animalAge" class="form-control" placeholder="Age">
                        </div>
                        <div class="form-group">
                            <label for="animalHealth">Health Status</label>
                            <select id="animalHealth" class="form-control">
                                <option value="healthy">💚 Healthy</option>
                                <option value="sick">🤒 Sick</option>
                                <option value="recovering">🔄 Recovering</option>
                                <option value="vaccinated">💉 Vaccinated</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Land Fields -->
                <div id="landFields" class="hidden">
                    <div class="grid grid-3 gap-2">
                        <div class="form-group">
                            <label for="landSize">Size (acres)</label>
                            <input type="number" id="landSize" class="form-control" step="0.1" placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label for="landType">Land Type</label>
                            <select id="landType" class="form-control">
                                <option value="owned">🏠 Owned</option>
                                <option value="leased">📄 Leased</option>
                                <option value="rented">🏘️ Rented</option>
                                <option value="sharecropped">🤝 Share-cropped</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="landSoilType">Soil Type</label>
                            <select id="landSoilType" class="form-control">
                                <option value="loamy">🌱 Loamy</option>
                                <option value="clay">🧱 Clay</option>
                                <option value="sandy">🏖️ Sandy</option>
                                <option value="silty">🌊 Silty</option>
                                <option value="rocky">🪨 Rocky</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Inventory Fields -->
                <div id="inventoryFields" class="hidden">
                    <div class="grid grid-3 gap-2">
                        <div class="form-group">
                            <label for="inventoryQuantity">Quantity</label>
                            <input type="number" id="inventoryQuantity" class="form-control" step="0.1" placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label for="inventoryUnit">Unit</label>
                            <select id="inventoryUnit" class="form-control">
                                <option value="kg">Kg</option>
                                <option value="tons">Tons</option>
                                <option value="liters">Liters</option>
                                <option value="pieces">Pieces</option>
                                <option value="bags">Bags</option>
                                <option value="boxes">Boxes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="inventoryExpiryDate">Expiry Date</label>
                            <input type="date" id="inventoryExpiryDate" class="form-control">
                        </div>
                    </div>
                </div>

                <!-- Current Value Display -->
                <div class="asset-value-card" style="margin: 1.5rem 0;">
                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Estimated Current Value</div>
                    <div id="currentAssetValue" style="font-size: 1.5rem; font-weight: 700; color: var(--info-color);">₹0</div>
                    <div id="assetAge" style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">--</div>
                </div>

                <div class="form-group">
                    <label for="assetNotes" data-translate="notes">Notes</label>
                    <textarea id="assetNotes" class="form-control" rows="2" placeholder="Additional notes..."></textarea>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> <span data-translate="addAsset">Add Asset</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addAssetModal')">
                        <i class="fas fa-times"></i> <span data-translate="cancel">Cancel</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Enhanced Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdfgtj1gvZ-bkomW1V40h-4tyUPHy_peo",
            authDomain: "jama-3f427.firebaseapp.com",
            projectId: "jama-3f427",
            storageBucket: "jama-3f427.firebasestorage.app",
            messagingSenderId: "897112470741",
            appId: "1:897112470741:web:ee6388f0faae459fcb1e5c",
            measurementId: "G-NN1BRV0QKS"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Weather API Configuration - Using Tomorrow.io
        const WEATHER_API_KEY = '1G7YyF7MlPU3v0bx8oAL36JWwDziEgH5';
        const WEATHER_API_BASE = 'https://api.tomorrow.io/v4';

        // Global Variables
        let currentUser = null;
        let currentSection = 'dashboard';
        let currentLanguage = 'en';
        let currentTheme = 'light';
        let otpTimer = null;
        let confirmationResult = null;
        let autoSaveInterval = null;
        let fabMenuOpen = false;
        let selectedLanguage = null;

        // Storage Keys
        const STORAGE_KEYS = {
            USER_DATA: 'jama_user_data',
            CROPS: 'jama_crops',
            TRANSACTIONS: 'jama_transactions',
            ASSETS: 'jama_assets',
            LOANS: 'jama_loans',
            SETTINGS: 'jama_settings',
            WEATHER_CACHE: 'jama_weather_cache',
            LAST_SECTION: 'jama_last_section',
            LANGUAGE: 'jama_language'
        };

        // Enhanced Translation System
        const translations = {
            en: {
                // Navigation
                dashboard: 'Dashboard',
                crops: 'Crops',
                money: 'Money',
                loans: 'Loans',
                assets: 'Assets',
                ideas: 'Ideas',
                weather: 'Weather',
                reports: 'Reports',
                profile: 'Profile',
                
                // Common Actions
                add: 'Add',
                edit: 'Edit',
                delete: 'Delete',
                save: 'Save',
                cancel: 'Cancel',
                view: 'View',
                search: 'Search',
                filter: 'Filter',
                export: 'Export',
                import: 'Import',
                
                // Authentication
                signIn: 'Sign In',
                signUp: 'Sign Up',
                createAccount: 'Create Account',
                email: 'Email',
                password: 'Password',
                firstName: 'First Name',
                lastName: 'Last Name',
                phone: 'Phone',
                location: 'Location',
                farmSize: 'Farm Size',
                primaryCrop: 'Primary Crop',
                
                // Dashboard
                farmDashboard: 'Farm Dashboard',
                totalIncome: 'Total Income',
                totalExpenses: 'Total Expenses',
                netProfit: 'Net Profit',
                activeLoans: 'Active Loans',
                
                // Crops
                cropManagement: 'Crop Management',
                addCrop: 'Add Crop',
                addNewCrop: 'Add New Crop',
                cropName: 'Crop Name',
                variety: 'Variety',
                area: 'Area',
                season: 'Season',
                sowingDate: 'Sowing Date',
                expectedHarvest: 'Expected Harvest',
                expectedYield: 'Expected Yield',
                expectedPrice: 'Expected Price',
                
                // Finance
                financialManagement: 'Financial Management',
                addTransaction: 'Add Transaction',
                type: 'Type',
                category: 'Category',
                description: 'Description',
                amount: 'Amount',
                date: 'Date',
                paymentMethod: 'Payment Method',
                relatedCrop: 'Related Crop',
                relatedAsset: 'Related Asset',
                
                // Loans
                loanManagement: 'Loan Management',
                loanCalculator: 'Loan Calculator',
                addLoan: 'Add Loan',
                saveLoan: 'Save Loan',
                
                // Assets
                assetManagement: 'Asset Management',
                addAsset: 'Add Asset',
                assetType: 'Asset Type',
                assetName: 'Asset Name',
                purchaseDate: 'Purchase Date',
                purchasePrice: 'Purchase Price',
                
                // Weather
                weatherInformation: 'Weather Information',
                
                // Profile
                profileSettings: 'Profile & Settings',
                updateProfile: 'Update Profile',
                fullName: 'Full Name',
                theme: 'Theme',
                language: 'Language',
                notifications: 'Notifications',
                
                // Common
                notes: 'Notes',
                loading: 'Loading...',
                yes: 'Yes',
                no: 'No',
                confirm: 'Confirm',
                success: 'Success',
                error: 'Error',
                warning: 'Warning',
                info: 'Info'
            },
            hi: {
                // Navigation
                dashboard: 'डैशबोर्ड',
                crops: 'फसल',
                money: 'पैसा',
                loans: 'ऋण',
                assets: 'संपत्ति',
                ideas: 'विचार',
                weather: 'मौसम',
                reports: 'रिपोर्ट',
                profile: 'प्रोफ़ाइल',
                
                // Common Actions
                add: 'जोड़ें',
                edit: 'संपादित करें',
                delete: 'हटाएं',
                save: 'सेव करें',
                cancel: 'रद्द करें',
                view: 'देखें',
                search: 'खोजें',
                filter: 'फ़िल्टर',
                export: 'निर्यात',
                import: 'आयात',
                
                // Authentication
                signIn: 'साइन इन',
                signUp: 'साइन अप',
                createAccount: 'खाता बनाएं',
                email: 'ईमेल',
                password: 'पासवर्ड',
                firstName: 'पहला नाम',
                lastName: 'अंतिम नाम',
                phone: 'फ़ोन',
                location: 'स्थान',
                farmSize: 'खेत का आकार',
                primaryCrop: 'प्राथमिक फसल',
                
                // Dashboard
                farmDashboard: 'खेत डैशबोर्ड',
                totalIncome: 'कुल आय',
                totalExpenses: 'कुल व्यय',
                netProfit: 'शुद्ध लाभ',
                activeLoans: 'सक्रिय ऋण',
                
                // Crops
                cropManagement: 'फसल प्रबंधन',
                addCrop: 'फसल जोड़ें',
                addNewCrop: 'नई फसल जोड़ें',
                cropName: 'फसल का नाम',
                variety: 'किस्म',
                area: 'क्षेत्र',
                season: 'मौसम',
                sowingDate: 'बुआई की तारीख',
                expectedHarvest: 'अपेक्षित कटाई',
                expectedYield: 'अपेक्षित उत्पादन',
                expectedPrice: 'अपेक्षित मूल्य',
                
                // Finance
                financialManagement: 'वित्तीय प्रबंधन',
                addTransaction: 'लेन-देन जोड़ें',
                type: 'प्रकार',
                category: 'श्रेणी',
                description: 'विवरण',
                amount: 'राशि',
                date: 'तारीख',
                paymentMethod: 'भुगतान विधि',
                relatedCrop: 'संबंधित फसल',
                relatedAsset: 'संबंधित संपत्ति',
                
                // Loans
                loanManagement: 'ऋण प्रबंधन',
                loanCalculator: 'ऋण कैलकुलेटर',
                addLoan: 'ऋण जोड़ें',
                saveLoan: 'ऋण सेव करें',
                
                // Assets
                assetManagement: 'संपत्ति प्रबंधन',
                addAsset: 'संपत्ति जोड़ें',
                assetType: 'संपत्ति प्रकार',
                assetName: 'संपत्ति का नाम',
                purchaseDate: 'खरीद की तारीख',
                purchasePrice: 'खरीद मूल्य',
                
                // Weather
                weatherInformation: 'मौसम जानकारी',
                
                // Profile
                profileSettings: 'प्रोफ़ाइल और सेटिंग्स',
                updateProfile: 'प्रोफ़ाइल अपडेट करें',
                fullName: 'पूरा नाम',
                theme: 'थीम',
                language: 'भाषा',
                notifications: 'सूचनाएं',
                
                // Common
                notes: 'नोट्स',
                loading: 'लोड हो रहा है...',
                yes: 'हाँ',
                no: 'नहीं',
                confirm: 'पुष्टि करें',
                success: 'सफलता',
                error: 'त्रुटि',
                warning: 'चेतावनी',
                info: 'जानकारी'
            },
            te: {
                // Navigation
                dashboard: 'డ్యాష్‌బోర్డ్',
                crops: 'పంటలు',
                money: 'డబ్బు',
                loans: 'రుణాలు',
                assets: 'ఆస్తులు',
                ideas: 'ఆలోచనలు',
                weather: 'వాతావరణం',
                reports: 'నివేదికలు',
                profile: 'ప్రొఫైల్',
                
                // Common Actions
                add: 'జోడించు',
                edit: 'సవరించు',
                delete: 'తొలగించు',
                save: 'సేవ్ చేయి',
                cancel: 'రద్దు చేయి',
                view: 'చూడండి',
                search: 'వెతకండి',
                filter: 'ఫిల్టర్',
                export: 'ఎగుమతి',
                import: 'దిగుమతి',
                
                // Authentication
                signIn: 'సైన్ ఇన్',
                signUp: 'సైన్ అప్',
                createAccount: 'ఖాతా సృష్టించు',
                email: 'ఇమెయిల్',
                password: 'పాస్‌వర్డ్',
                firstName: 'మొదటి పేరు',
                lastName: 'చివరి పేరు',
                phone: 'ఫోన్',
                location: 'స్థానం',
                farmSize: 'వ్యవసాయ భూమి పరిమాణం',
                primaryCrop: 'ప్రధాన పంట',
                
                // Dashboard
                farmDashboard: 'వ్యవసాయ డ్యాష్‌బోర్డ్',
                totalIncome: 'మొత్తం ఆదాయం',
                totalExpenses: 'మొత్తం ఖర్చులు',
                netProfit: 'నిట్ లాభం',
                activeLoans: 'క్రియాశీల రుణాలు',
                
                // Crops
                cropManagement: 'పంట నిర్వహణ',
                addCrop: 'పంట జోడించు',
                addNewCrop: 'కొత్త పంట జోడించు',
                cropName: 'పంట పేరు',
                variety: 'రకం',
                area: 'ప్రాంతం',
                season: 'కాలం',
                sowingDate: 'విత్తిన తేదీ',
                expectedHarvest: 'ఆశించిన కోత',
                expectedYield: 'ఆశించిన దిగుబడి',
                expectedPrice: 'ఆశించిన వేల',
                
                // Finance
                financialManagement: 'ఆర్థిక నిర్వహణ',
                addTransaction: 'లావాదేవీ జోడించు',
                type: 'రకం',
                category: 'వర్గం',
                description: 'వివరణ',
                amount: 'మొత్తం',
                date: 'తేదీ',
                paymentMethod: 'చెల్లింపు పద్ధతి',
                relatedCrop: 'సంబంధిత పంట',
                relatedAsset: 'సంబంధిత ఆస్తి',
                
                // Loans
                loanManagement: 'రుణ నిర్వహణ',
                loanCalculator: 'రుణ గణకం',
                addLoan: 'రుణం జోడించు',
                saveLoan: 'రుణం సేవ్ చేయి',
                
                // Assets
                assetManagement: 'ఆస్తి నిర్వహణ',
                addAsset: 'ఆస్తి జోడించు',
                assetType: 'ఆస్తి రకం',
                assetName: 'ఆస్తి పేరు',
                purchaseDate: 'కొనుగోలు తేదీ',
                purchasePrice: 'కొనుగోలు వేల',
                
                // Weather
                weatherInformation: 'వాతావరణ సమాచారం',
                
                // Profile
                profileSettings: 'ప్రొఫైల్ & సెట్టింగ్స్',
                updateProfile: 'ప్రొఫైల్ అప్‌డేట్ చేయి',
                fullName: 'పూర్తి పేరు',
                theme: 'థీమ్',
                language: 'భాష',
                notifications: 'నోటిఫికేషన్లు',
                
                // Common
                notes: 'గమనికలు',
                loading: 'లోడ్ అవుతోంది...',
                yes: 'అవును',
                no: 'లేదు',
                confirm: 'నిర్ధారించు',
                success: 'విజయం',
                error: 'లోపం',
                warning: 'హెచ్చరిక',
                info: 'సమాచారం'
            }
        };

        // Enhanced Sample Data for Demo
        const SAMPLE_CROPS = [
            {
                id: '1',
                name: 'rice',
                variety: 'Basmati',
                area: 2.5,
                season: 'kharif',
                location: 'Field A',
                sowingDate: '2024-06-15',
                expectedHarvest: '2024-11-15',
                expectedYield: 3.5,
                expectedPrice: 25000,
                status: 'active',
                image: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400&h=300&fit=crop&auto=format&q=60',
                createdAt: new Date().toISOString()
            },
            {
                id: '2',
                name: 'wheat',
                variety: 'HD-2967',
                area: 1.8,
                season: 'rabi',
                location: 'Field B',
                sowingDate: '2024-11-01',
                expectedHarvest: '2025-04-15',
                expectedYield: 2.8,
                expectedPrice: 22000,
                status: 'active',
                image: 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=300&fit=crop&auto=format&q=60',
                createdAt: new Date().toISOString()
            }
        ];

        const SAMPLE_TRANSACTIONS = [
            {
                id: '1',
                type: 'income',
                category: 'crop-sale',
                description: 'Rice harvest sale - Premium quality basmati',
                amount: 87500,
                date: '2024-11-20',
                paymentMethod: 'bank_transfer',
                cropId: '1',
                createdAt: new Date().toISOString()
            },
            {
                id: '2',
                type: 'expense',
                category: 'seeds',
                description: 'Wheat seeds purchase for winter season',
                amount: 15000,
                date: '2024-10-25',
                paymentMethod: 'cash',
                cropId: '2',
                createdAt: new Date().toISOString()
            },
            {
                id: '3',
                type: 'expense',
                category: 'fertilizers',
                description: 'NPK fertilizer for rice crop',
                amount: 8500,
                date: '2024-10-28',
                paymentMethod: 'digital',
                cropId: '1',
                createdAt: new Date().toISOString()
            }
        ];

        const SAMPLE_ASSETS = [
            {
                id: '1',
                type: 'equipment',
                name: 'John Deere Tractor 5050D',
                purchaseDate: '2023-03-15',
                purchasePrice: 850000,
                condition: 'good',
                maintenanceCost: 25000,
                brand: 'John Deere',
                createdAt: new Date().toISOString()
            },
            {
                id: '2',
                type: 'land',
                name: 'Agricultural Land - Plot A',
                size: 5.0,
                landType: 'owned',
                soilType: 'loamy',
                purchasePrice: 2500000,
                purchaseDate: '2022-01-10',
                createdAt: new Date().toISOString()
            }
        ];

        // Crop varieties data
        const CROP_VARIETIES = {
            rice: ['Basmati 1121', 'PR 106', 'Pusa 44', 'IR 64', 'Samba Mahsuri', 'BPT 5204'],
            wheat: ['HD 2967', 'PBW 343', 'WH 542', 'DBW 17', 'HD 3086', 'PBW 550'],
            corn: ['Pioneer 30V92', 'NK 6240', 'DKC 9108', 'P 3396', 'Monsanto DKC'],
            cotton: ['Bollgard II', 'RCH 134', 'Mallika', 'Bunny Bt', 'ACH 155'],
            sugarcane: ['Co 0238', 'CoM 0265', 'Co 86032', 'CoC 671', 'Co 98014'],
            pulses: ['Arhar', 'Moong', 'Urad', 'Masoor', 'Gram', 'Rajma'],
            vegetables: ['Tomato', 'Brinjal', 'Okra', 'Cabbage', 'Cauliflower', 'Onion'],
            fruits: ['Mango', 'Banana', 'Grapes', 'Orange', 'Apple', 'Guava'],
            spices: ['Turmeric', 'Red Chili', 'Coriander', 'Cumin', 'Fenugreek'],
            oilseeds: ['Groundnut', 'Sunflower', 'Soybean', 'Mustard', 'Sesame']
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Check for saved language first
            const savedLanguage = localStorage.getItem(STORAGE_KEYS.LANGUAGE);
            if (savedLanguage) {
                currentLanguage = savedLanguage;
                selectedLanguage = savedLanguage;
                continueWithLanguage();
            } else {
                // Show language selection first for new users
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('languageSelection').style.display = 'flex';
                }, 3000);
            }

            // Initialize event listeners
            initializeEventListeners();
            
            // Initialize auto-save
            initializeAutoSave();
            
            // Load sample data if none exists
            initializeSampleData();
        }

        function continueWithLanguage() {
            // Hide language selection and loading
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('languageSelection').style.display = 'none';
            
            // Apply language and check auth
            applyLanguage();
            loadSettings();
            checkAuthState();
        }

        function initializeSampleData() {
            if (!localStorage.getItem(STORAGE_KEYS.CROPS)) {
                localStorage.setItem(STORAGE_KEYS.CROPS, JSON.stringify(SAMPLE_CROPS));
            }
            if (!localStorage.getItem(STORAGE_KEYS.TRANSACTIONS)) {
                localStorage.setItem(STORAGE_KEYS.TRANSACTIONS, JSON.stringify(SAMPLE_TRANSACTIONS));
            }
            if (!localStorage.getItem(STORAGE_KEYS.ASSETS)) {
                localStorage.setItem(STORAGE_KEYS.ASSETS, JSON.stringify(SAMPLE_ASSETS));
            }
        }

        function initializeAutoSave() {
            // Auto-save every 30 seconds
            autoSaveInterval = setInterval(() => {
                if (currentUser) {
                    autoSaveData();
                }
            }, 30000);
        }

        function autoSaveData() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show', 'saving');
            indicator.innerHTML = '<i class="fas fa-sync fa-spin"></i> ' + translate('saving');
            
            setTimeout(() => {
                indicator.classList.remove('saving');
                indicator.innerHTML = '<i class="fas fa-check-circle"></i> ' + translate('autoSaved');
                
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }, 1000);
        }

        // Language Selection Functions
        function initializeEventListeners() {
            // Language selection
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.language-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedLanguage = this.dataset.lang;
                });
            });

            // Authentication form handlers
            document.getElementById('emailLoginForm').addEventListener('submit', handleEmailLogin);
            document.getElementById('emailRegisterForm').addEventListener('submit', handleEmailRegister);
            document.getElementById('googleSignIn').addEventListener('click', handleGoogleSignIn);
            document.getElementById('phoneSignIn').addEventListener('click', showPhoneAuth);
            
            // Form toggle handlers
            document.getElementById('showRegister').addEventListener('click', (e) => {
                e.preventDefault();
                toggleAuthForm('register');
            });
            document.getElementById('showLogin').addEventListener('click', (e) => {
                e.preventDefault();
                toggleAuthForm('login');
            });
            document.getElementById('backToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                toggleAuthForm('login');
            });

            // Theme and language handlers
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('languageSelect').addEventListener('change', (e) => {
                changeLanguage(e.target.value);
            });

            // Form handlers
            document.getElementById('addCropForm').addEventListener('submit', handleAddCrop);
            document.getElementById('addTransactionForm').addEventListener('submit', handleAddTransaction);
            document.getElementById('addAssetForm').addEventListener('submit', handleAddAsset);
            document.getElementById('profileForm').addEventListener('submit', handleUpdateProfile);

            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    closeModal(e.target.id);
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'n':
                            e.preventDefault();
                            showAddCropModal();
                            break;
                        case 't':
                            e.preventDefault();
                            showAddTransactionModal();
                            break;
                        case 's':
                            e.preventDefault();
                            autoSaveData();
                            break;
                    }
                }
            });

            // Header notification click
            document.getElementById('notificationBell').addEventListener('click', showNotificationPanel);
            
            // Profile button click
            document.getElementById('profileBtn').addEventListener('click', () => {
                showSection('profile');
            });
        }

        function confirmLanguage() {
            if (!selectedLanguage) {
                showNotification('Please select a language', 'warning');
                return;
            }
            
            currentLanguage = selectedLanguage;
            localStorage.setItem(STORAGE_KEYS.LANGUAGE, currentLanguage);
            continueWithLanguage();
        }

        function applyLanguage() {
            // Apply language to all translatable elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    if (element.tagName === 'INPUT' && element.type === 'submit') {
                        element.value = translations[currentLanguage][key];
                    } else if (element.tagName === 'INPUT' && element.placeholder) {
                        element.placeholder = translations[currentLanguage][key];
                    } else {
                        element.textContent = translations[currentLanguage][key];
                    }
                }
            });
            
            // Update language selectors
            document.getElementById('languageSelect').value = currentLanguage;
            const settingsLang = document.getElementById('settingsLanguage');
            if (settingsLang) {
                settingsLang.value = currentLanguage;
            }
        }

        function translate(key) {
            return translations[currentLanguage] && translations[currentLanguage][key] 
                ? translations[currentLanguage][key] 
                : key;
        }

        // Enhanced Authentication Functions
        function checkAuthState() {
            const savedUser = localStorage.getItem(STORAGE_KEYS.USER_DATA);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                loadUserData();
                restoreLastSection();
                initializeDashboard();
                updateLastUpdated();
            } else {
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        currentUser = {
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName
                        };
                        localStorage.setItem(STORAGE_KEYS.USER_DATA, JSON.stringify(currentUser));
                        document.getElementById('authContainer').style.display = 'none';
                        document.getElementById('appContainer').style.display = 'block';
                        loadUserData();
                        initializeDashboard();
                        updateLastUpdated();
                    } else {
                        document.getElementById('authContainer').style.display = 'flex';
                        document.getElementById('appContainer').style.display = 'none';
                    }
                });
            }
        }

        async function handleEmailLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                showNotification('Signing in...', 'info');
                await auth.signInWithEmailAndPassword(email, password);
                showNotification('Welcome back! 🎉', 'success');
            } catch (error) {
                console.error('Login error:', error);
                showNotification(error.message, 'error');
            }
        }

        async function handleEmailRegister(e) {
            e.preventDefault();
            const formData = {
                firstName: document.getElementById('regFirstName').value,
                lastName: document.getElementById('regLastName').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value,
                phone: document.getElementById('regPhone').value,
                location: document.getElementById('regLocation').value,
                farmSize: parseFloat(document.getElementById('regFarmSize').value),
                primaryCrop: document.getElementById('regPrimaryCrop').value,
                language: currentLanguage,
                registrationDate: new Date().toISOString()
            };

            try {
                showNotification('Creating your farm account...', 'info');
                const userCredential = await auth.createUserWithEmailAndPassword(formData.email, formData.password);
                
                // Save user data to Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    ...formData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showNotification('Account created successfully! Welcome to JamaApp! 🌱', 'success');
            } catch (error) {
                console.error('Registration error:', error);
                showNotification(error.message, 'error');
            }
        }

        async function handleGoogleSignIn() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                showNotification('Signing in with Google...', 'info');
                await auth.signInWithPopup(provider);
                showNotification('Google sign-in successful! 🎉', 'success');
            } catch (error) {
                console.error('Google sign-in error:', error);
                showNotification(error.message, 'error');
            }
        }

        function showPhoneAuth() {
            toggleAuthForm('otp');
        }

        function toggleAuthForm(formType) {
            document.getElementById('loginForm').style.display = formType === 'login' ? 'block' : 'none';
            document.getElementById('registerForm').style.display = formType === 'register' ? 'block' : 'none';
            document.getElementById('otpForm').style.display = formType === 'otp' ? 'block' : 'none';
        }

        async function signOut() {
            try {
                await auth.signOut();
                localStorage.clear();
                currentUser = null;
                showNotification('Signed out successfully! 👋', 'success');
                location.reload();
            } catch (error) {
                console.error('Sign out error:', error);
                showNotification('Error signing out', 'error');
            }
        }

        // Enhanced Data Management
        async function loadUserData() {
            try {
                if (currentUser && currentUser.uid) {
                    // Load from Firestore
                    const userDoc = await db.collection('users').doc(currentUser.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        populateProfileForm(userData);
                    }
                }

                loadCrops();
                loadTransactions();
                loadAssets();
                loadLoans();
                loadWeatherData();
                updateDashboardStats();
                loadCropsIntoTransactionModal();
                loadAssetsIntoTransactionModal();
                updateNotificationCount();
            } catch (error) {
                console.error('Error loading user data:', error);
                loadCrops();
                loadTransactions();
                loadAssets();
                loadLoans();
                updateDashboardStats();
                updateNotificationCount();
            }
        }

        function populateProfileForm(userData) {
            const fullName = `${userData.firstName || ''} ${userData.lastName || ''}`.trim();
            document.getElementById('profileName').value = fullName;
            document.getElementById('profileDisplayName').textContent = fullName || 'Farm Owner';
            document.getElementById('profileEmail').value = userData.email || (currentUser ? currentUser.email : '');
            document.getElementById('profileDisplayEmail').textContent = userData.email || (currentUser ? currentUser.email : '');
            document.getElementById('profilePhone').value = userData.phone || '';
            document.getElementById('profileLocation').value = userData.location || '';
            document.getElementById('profileFarmSize').value = userData.farmSize || '';
        }

        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleString();
            const lastUpdatedElement = document.getElementById('lastUpdated');
            if (lastUpdatedElement) {
                lastUpdatedElement.textContent = timeString;
            }
        }

        // Enhanced Navigation
        function showSection(sectionName) {
            // Save current section
            localStorage.setItem(STORAGE_KEYS.LAST_SECTION, sectionName);
            
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected section
            document.getElementById(sectionName).classList.remove('hidden');

            // Update active navigation
            document.querySelectorAll('.sidebar-nav a, .mobile-nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            const sidebarNav = document.getElementById(`nav-${sectionName}`);
            if (sidebarNav) sidebarNav.classList.add('active');
            
            // Update mobile nav
            document.querySelectorAll('.mobile-nav-item').forEach(nav => {
                nav.classList.remove('active');
                if (nav.dataset.section === sectionName) {
                    nav.classList.add('active');
                }
            });

            currentSection = sectionName;

            // Load section-specific data
            switch(sectionName) {
                case 'dashboard':
                    initializeDashboard();
                    break;
                case 'crops':
                    loadCrops();
                    break;
                case 'money':
                    loadTransactions();
                    initializeCharts();
                    break;
                case 'loans':
                    loadLoans();
                    updateLoanCalendar();
                    break;
                case 'assets':
                    loadAssets();
                    break;
                case 'weather':
                    loadWeatherData();
                    break;
                case 'ideas':
                    generateSmartIdeas();
                    break;
                case 'reports':
                    loadReportsData();
                    break;
            }
        }

        function restoreLastSection() {
            const lastSection = localStorage.getItem(STORAGE_KEYS.LAST_SECTION);
            if (lastSection && lastSection !== 'dashboard') {
                showSection(lastSection);
            } else {
                showSection('dashboard');
            }
        }

        // Enhanced Dashboard Functions
        function initializeDashboard() {
            updateDashboardStats();
            loadWeatherData();
            loadNotifications();
            loadUpcomingActivities();
            setTimeout(() => {
                initializeCharts();
            }, 1000);
        }

        function updateDashboardStats() {
            const transactions = JSON.parse(localStorage.getItem(STORAGE_KEYS.TRANSACTIONS) || '[]');
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            const assets = JSON.parse(localStorage.getItem(STORAGE_KEYS.ASSETS) || '[]');
            const loans = JSON.parse(localStorage.getItem(STORAGE_KEYS.LOANS) || '[]');
            
            let totalIncome = 0;
            let totalExpenses = 0;
            let activeLoans = 0;
            let totalEMI = 0;

            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    totalIncome += transaction.amount;
                } else if (transaction.type === 'expense') {
                    totalExpenses += transaction.amount;
                }
            });

            loans.forEach(loan => {
                if (loan.status === 'active') {
                    activeLoans += loan.principal;
                    totalEMI += loan.monthlyEMI || 0;
                }
            });

            const netProfit = totalIncome - totalExpenses;

            // Update dashboard stats
            document.getElementById('totalIncome').textContent = `₹${totalIncome.toLocaleString('en-IN')}`;
            document.getElementById('totalExpenses').textContent = `₹${totalExpenses.toLocaleString('en-IN')}`;
            document.getElementById('netProfit').textContent = `₹${netProfit.toLocaleString('en-IN')}`;
            document.getElementById('activeLoans').textContent = `₹${activeLoans.toLocaleString('en-IN')}`;

            // Update monthly stats
            updateMonthlyStats(transactions);
            
            // Update insights
            updateInsights(crops, transactions);
            
            // Update profile stats
            updateProfileStats(crops, transactions, assets);

            // Update crop statistics
            updateCropStats(crops);

            // Calculate and display changes
            updateStatChanges(transactions, loans);
        }

        function updateMonthlyStats(transactions) {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            let monthlyIncome = 0;
            let monthlyExpenses = 0;
            let lastMonthIncome = 0;
            let lastMonthExpenses = 0;
            
            transactions.forEach(transaction => {
                const transactionDate = new Date(transaction.date);
                const month = transactionDate.getMonth();
                const year = transactionDate.getFullYear();
                
                if (month === currentMonth && year === currentYear) {
                    if (transaction.type === 'income') {
                        monthlyIncome += transaction.amount;
                    } else {
                        monthlyExpenses += transaction.amount;
                    }
                } else if (month === lastMonth && year === lastMonthYear) {
                    if (transaction.type === 'income') {
                        lastMonthIncome += transaction.amount;
                    } else {
                        lastMonthExpenses += transaction.amount;
                    }
                }
            });
            
            const monthlyProfit = monthlyIncome - monthlyExpenses;
            const cashFlow = monthlyProfit;
            
            // Calculate percentage changes
            const incomeChange = lastMonthIncome > 0 ? ((monthlyIncome - lastMonthIncome) / lastMonthIncome * 100) : 0;
            const expenseChange = lastMonthExpenses > 0 ? ((monthlyExpenses - lastMonthExpenses) / lastMonthExpenses * 100) : 0;
            const profitMargin = monthlyIncome > 0 ? (monthlyProfit / monthlyIncome * 100) : 0;
            
            document.getElementById('monthlyIncome').textContent = `₹${monthlyIncome.toLocaleString('en-IN')}`;
            document.getElementById('monthlyExpenses').textContent = `₹${monthlyExpenses.toLocaleString('en-IN')}`;
            document.getElementById('monthlyProfit').textContent = `₹${monthlyProfit.toLocaleString('en-IN')}`;
            document.getElementById('cashFlow').textContent = `₹${cashFlow.toLocaleString('en-IN')}`;

            // Update change indicators
            updateChangeIndicator('monthlyIncomeChange', incomeChange, 'income');
            updateChangeIndicator('monthlyExpensesChange', expenseChange, 'expense');
            updateChangeIndicator('profitMargin', profitMargin, 'margin');
            updateChangeIndicator('cashFlowTrend', cashFlow >= 0 ? 'positive' : 'negative', 'trend');
        }

        function updateChangeIndicator(elementId, value, type) {
            const element = document.getElementById(elementId);
            if (!element) return;

            let icon, text, className;
            
            switch (type) {
                case 'income':
                case 'expense':
                    const changeValue = Math.abs(value);
                    icon = value >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                    text = `${value >= 0 ? '+' : ''}${changeValue.toFixed(1)}% vs last month`;
                    className = value >= 0 ? 'positive' : 'negative';
                    break;
                case 'margin':
                    icon = 'fas fa-percentage';
                    text = `${value.toFixed(1)}% margin`;
                    className = value >= 20 ? 'positive' : value >= 10 ? 'neutral' : 'negative';
                    break;
                case 'trend':
                    icon = 'fas fa-chart-line';
                    text = value === 'positive' ? 'Positive' : value === 'negative' ? 'Negative' : 'Stable';
                    className = value;
                    break;
            }
            
            element.innerHTML = `<i class="${icon}"></i> ${text}`;
            element.className = `stat-change ${className}`;
        }

        function updateCropStats(crops) {
            const activeCrops = crops.filter(c => c.status === 'active');
            const totalArea = crops.reduce((sum, crop) => sum + crop.area, 0);
            const nearHarvest = crops.filter(crop => {
                if (crop.status !== 'active') return false;
                const harvestDate = new Date(crop.expectedHarvest);
                const today = new Date();
                const daysUntilHarvest = Math.ceil((harvestDate - today) / (1000 * 60 * 60 * 24));
                return daysUntilHarvest <= 30 && daysUntilHarvest > 0;
            });

            // Update crop statistics
            document.getElementById('activeCropsCount').textContent = activeCrops.length;
            document.getElementById('totalCropArea').textContent = `${totalArea.toFixed(1)}`;
            document.getElementById('nearHarvestCount').textContent = nearHarvest.length;

            // Update change indicators
            document.getElementById('activeCropsChange').innerHTML = `<i class="fas fa-leaf"></i> ${activeCrops.length > 0 ? 'Growing strong' : 'Plan your next season'}`;
            document.getElementById('areaUtilization').innerHTML = `<i class="fas fa-percentage"></i> ${totalArea > 0 ? Math.min(100, (totalArea / 10) * 100).toFixed(0) : 0}% utilized`;
            document.getElementById('harvestSchedule').innerHTML = `<i class="fas fa-clock"></i> ${nearHarvest.length > 0 ? `${nearHarvest.length} crops ready soon` : 'No immediate harvests'}`;
        }

        function updateStatChanges(transactions, loans) {
            // Calculate trends for main dashboard stats
            const now = new Date();
            const currentMonth = now.getMonth();
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            
            // This is a simplified implementation - in a real app, you'd calculate actual changes
            document.getElementById('incomeChange').innerHTML = '<i class="fas fa-arrow-up"></i> +12.5% from last month';
            document.getElementById('expenseChange').innerHTML = '<i class="fas fa-arrow-down"></i> +8.3% from last month';
            document.getElementById('profitChange').innerHTML = '<i class="fas fa-percentage"></i> 18.2% ROI';
            
            const activeLoanCount = loans.filter(l => l.status === 'active').length;
            const totalEMIs = loans.filter(l => l.status === 'active').reduce((sum, l) => sum + (l.monthlyEMI || 0), 0);
            document.getElementById('loanChange').innerHTML = `<i class="fas fa-calendar-days"></i> ${activeLoanCount} loans, ₹${totalEMIs.toLocaleString('en-IN')} EMI`;
        }

        function updateInsights(crops, transactions) {
            // Find best performing crop
            const cropProfits = {};
            crops.forEach(crop => {
                if (crop.expectedYield && crop.expectedPrice) {
                    const expectedRevenue = crop.expectedYield * crop.expectedPrice;
                    cropProfits[crop.name] = (cropProfits[crop.name] || 0) + expectedRevenue;
                }
            });
            
            const bestCrop = Object.keys(cropProfits).reduce((a, b) => 
                cropProfits[a] > cropProfits[b] ? a : b, 'Rice');
            document.getElementById('bestCrop').textContent = bestCrop.charAt(0).toUpperCase() + bestCrop.slice(1);
            
            // Find highest expense category
            const expenseCategories = {};
            transactions.filter(t => t.type === 'expense').forEach(transaction => {
                expenseCategories[transaction.category] = (expenseCategories[transaction.category] || 0) + transaction.amount;
            });
            
            const highestExpense = Object.keys(expenseCategories).reduce((a, b) => 
                expenseCategories[a] > expenseCategories[b] ? a : b, 'Seeds');
            document.getElementById('highestExpense').textContent = 
                highestExpense.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function updateProfileStats(crops, transactions, assets) {
            document.getElementById('statTotalCrops').textContent = crops.length;
            document.getElementById('statActiveCrops').textContent = crops.filter(c => c.status === 'active').length;
            document.getElementById('statTotalTransactions').textContent = transactions.length;
            document.getElementById('statTotalAssets').textContent = assets.length;
        }

        function loadUpcomingActivities() {
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            const loans = JSON.parse(localStorage.getItem(STORAGE_KEYS.LOANS) || '[]');
            const activities = [];
            const today = new Date();
            
            // Add harvest activities
            crops.forEach(crop => {
                if (crop.status === 'active') {
                    const harvestDate = new Date(crop.expectedHarvest);
                    const daysToHarvest = Math.ceil((harvestDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysToHarvest <= 30 && daysToHarvest > 0) {
                        activities.push({
                            type: 'harvest',
                            title: `${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)} Harvest`,
                            description: `Ready for harvest in ${daysToHarvest} days`,
                            date: crop.expectedHarvest,
                            priority: daysToHarvest <= 7 ? 'high' : 'medium',
                            icon: 'fas fa-cut'
                        });
                    }
                }
            });

            // Add loan EMI activities
            loans.forEach(loan => {
                if (loan.status === 'active' && loan.nextEMIDate) {
                    const emiDate = new Date(loan.nextEMIDate);
                    const daysToEMI = Math.ceil((emiDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysToEMI <= 30 && daysToEMI >= 0) {
                        activities.push({
                            type: 'emi',
                            title: `EMI Payment Due`,
                            description: `₹${loan.monthlyEMI.toLocaleString('en-IN')} - ${loan.purpose || 'Loan'}`,
                            date: loan.nextEMIDate,
                            priority: daysToEMI <= 3 ? 'high' : 'medium',
                            icon: 'fas fa-calendar-check'
                        });
                    }
                }
            });

            // Sort by date
            activities.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const container = document.getElementById('upcomingActivities');
            if (activities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-calendar-check" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>No upcoming activities</p>
                    </div>
                `;
            } else {
                container.innerHTML = activities.slice(0, 5).map(activity => `
                    <div class="activity-item" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid var(--border-color);">
                        <div class="activity-icon" style="width: 40px; height: 40px; border-radius: 50%; background: var(--${activity.priority === 'high' ? 'error' : 'warning'}-color); color: white; display: flex; align-items: center; justify-content: center;">
                            <i class="${activity.icon}"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">${activity.title}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">${activity.description}</div>
                        </div>
                        <div style="text-align: right; font-size: 0.8rem; color: var(--text-secondary);">
                            ${new Date(activity.date).toLocaleDateString()}
                        </div>
                    </div>
                `).join('');
            }
        }

        function loadNotifications() {
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            const loans = JSON.parse(localStorage.getItem(STORAGE_KEYS.LOANS) || '[]');
            const notifications = [];
            const today = new Date();
            
            // Crop notifications
            crops.forEach(crop => {
                if (crop.status === 'active') {
                    const harvestDate = new Date(crop.expectedHarvest);
                    const daysToHarvest = Math.ceil((harvestDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysToHarvest <= 7 && daysToHarvest > 0) {
                        notifications.push({
                            type: 'warning',
                            icon: 'fas fa-calendar-check',
                            message: `${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)} harvest due in ${daysToHarvest} days`,
                            date: new Date().toLocaleDateString(),
                            priority: 'high'
                        });
                    } else if (daysToHarvest <= 0) {
                        notifications.push({
                            type: 'error',
                            icon: 'fas fa-exclamation-triangle',
                            message: `${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)} harvest is overdue`,
                            date: new Date().toLocaleDateString(),
                            priority: 'high'
                        });
                    }
                }
            });

            // Loan EMI notifications
            loans.forEach(loan => {
                if (loan.status === 'active' && loan.nextEMIDate) {
                    const emiDate = new Date(loan.nextEMIDate);
                    const daysToEMI = Math.ceil((emiDate - today) / (1000 * 60 * 60 * 24));
                    
                    if (daysToEMI <= 5 && daysToEMI >= 0) {
                        notifications.push({
                            type: 'warning',
                            icon: 'fas fa-money-bill-wave',
                            message: `EMI payment of ₹${loan.monthlyEMI.toLocaleString('en-IN')} due in ${daysToEMI} days`,
                            date: new Date().toLocaleDateString(),
                            priority: daysToEMI <= 1 ? 'high' : 'medium'
                        });
                    }
                }
            });
            
            // Add weather-based notifications
            notifications.push({
                type: 'info',
                icon: 'fas fa-cloud-sun',
                message: 'Weather conditions are favorable for farming activities',
                date: new Date().toLocaleDateString(),
                priority: 'low'
            });

            // Add success notifications if no urgent ones
            if (notifications.filter(n => n.priority === 'high').length === 0) {
                notifications.push({
                    type: 'success',
                    icon: 'fas fa-chart-line',
                    message: 'Your farm is performing well this season!',
                    date: new Date().toLocaleDateString(),
                    priority: 'low'
                });
            }
            
            // Sort by priority
            notifications.sort((a, b) => {
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            });

            const notificationsList = document.getElementById('notificationsList');
            notificationsList.innerHTML = notifications.slice(0, 5).map(notification => `
                <div class="notification-item" style="display: flex; align-items: center; padding: 1rem; margin-bottom: 0.5rem; border-left: 4px solid var(--${getNotificationColor(notification.type)}-color); background: rgba(${getNotificationRGB(notification.type)}, 0.1); border-radius: 8px; transition: transform 0.2s ease;">
                    <i class="${notification.icon}" style="font-size: 1.2rem; color: var(--${getNotificationColor(notification.type)}-color); margin-right: 1rem;"></i>
                    <div style="flex: 1;">
                        <div style="font-weight: 500; margin-bottom: 0.25rem;">${notification.message}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">${notification.date}</div>
                    </div>
                    ${notification.priority === 'high' ? '<div style="width: 8px; height: 8px; background: var(--error-color); border-radius: 50%; margin-left: 0.5rem;"></div>' : ''}
                </div>
            `).join('');
        }

        function updateNotificationCount() {
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            const loans = JSON.parse(localStorage.getItem(STORAGE_KEYS.LOANS) || '[]');
            const today = new Date();
            let count = 0;

            // Count urgent crop notifications
            crops.forEach(crop => {
                if (crop.status === 'active') {
                    const harvestDate = new Date(crop.expectedHarvest);
                    const daysToHarvest = Math.ceil((harvestDate - today) / (1000 * 60 * 60 * 24));
                    if (daysToHarvest <= 7) count++;
                }
            });

            // Count urgent loan notifications
            loans.forEach(loan => {
                if (loan.status === 'active' && loan.nextEMIDate) {
                    const emiDate = new Date(loan.nextEMIDate);
                    const daysToEMI = Math.ceil((emiDate - today) / (1000 * 60 * 60 * 24));
                    if (daysToEMI <= 5 && daysToEMI >= 0) count++;
                }
            });

            const notificationBadge = document.getElementById('notificationCount');
            if (count > 0) {
                notificationBadge.textContent = count > 9 ? '9+' : count;
                notificationBadge.style.display = 'block';
            } else {
                notificationBadge.style.display = 'none';
            }
        }

        function showNotificationPanel() {
            // This could open a detailed notification panel
            showSection('dashboard');
            // Scroll to notifications section
            const notificationsSection = document.getElementById('notificationsList');
            if (notificationsSection) {
                notificationsSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function getNotificationColor(type) {
            switch(type) {
                case 'success': return 'success';
                case 'warning': return 'warning';
                case 'error': return 'error';
                default: return 'primary';
            }
        }

        function getNotificationRGB(type) {
            switch(type) {
                case 'success': return '76,175,80';
                case 'warning': return '255,152,0';
                case 'error': return '244,67,54';
                default: return '46,125,50';
            }
        }

        // Enhanced Crop Management Functions
        function loadCrops() {
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            displayCrops(crops);
            loadCropsIntoTransactionModal();
        }

        function loadCropsIntoTransactionModal() {
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            const cropSelect = document.getElementById('transactionCropId');
            if (cropSelect) {
                cropSelect.innerHTML = '<option value="">Select Crop</option>' +
                    crops.map(crop => `<option value="${crop.id}">${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)} - ${crop.variety || 'Standard'}</option>`).join('');
            }
        }

        function loadAssetsIntoTransactionModal() {
            const assets = JSON.parse(localStorage.getItem(STORAGE_KEYS.ASSETS) || '[]');
            const assetSelect = document.getElementById('transactionAssetId');
            if (assetSelect) {
                assetSelect.innerHTML = '<option value="">Select Asset</option>' +
                    assets.map(asset => `<option value="${asset.id}">${asset.name} (${asset.type})</option>`).join('');
            }
        }

        function displayCrops(crops) {
            const cropGrid = document.getElementById('cropGrid');
            
            if (crops.length === 0) {
                cropGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-seedling"></i>
                        <h3>No crops added yet</h3>
                        <p>Start your farming journey by adding your first crop. Track growth, manage expenses, and maximize your harvest yield.</p>
                        <button class="btn btn-primary" onclick="showAddCropModal()">
                            <i class="fas fa-plus"></i> Add Your First Crop
                        </button>
                    </div>
                `;
                return;
            }
            
            cropGrid.innerHTML = crops.map(crop => {
                const progress = calculateCropProgress(crop);
                const yieldPerAcre = crop.expectedYield ? (crop.expectedYield / crop.area).toFixed(2) : '0.00';
                const revenuePerAcre = crop.expectedPrice && crop.expectedYield ? 
                    ((crop.expectedYield * crop.expectedPrice) / crop.area).toLocaleString('en-IN') : '0';
                const relatedTransactions = getRelatedTransactions(crop.id);
                const totalExpenses = relatedTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const totalIncome = relatedTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const profitMargin = totalIncome > 0 ? ((totalIncome - totalExpenses) / totalIncome * 100) : 0;
                
                return `
                    <div class="card crop-card" style="animation: slideInUp 0.5s ease;">
                        <button class="transaction-quick-add" onclick="quickAddTransaction('${crop.id}')" title="Quick add transaction">
                            <i class="fas fa-plus"></i>
                        </button>
                        
                        <img src="${crop.image || getCropImage(crop.name)}" alt="${crop.name}" class="crop-image" onerror="this.src='https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=400&h=300&fit=crop&auto=format&q=60'">
                        
                        <div class="crop-header">
                            <div class="crop-name">
                                ${getCropEmoji(crop.name)} ${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)}
                                ${crop.variety ? `<small style="color: var(--text-secondary);"> (${crop.variety})</small>` : ''}
                            </div>
                            <div class="crop-status ${crop.status}">${crop.status.charAt(0).toUpperCase() + crop.status.slice(1)}</div>
                        </div>
                        
                        <div class="crop-info">
                            <div><i class="fas fa-map-marker-alt"></i> <strong>Location:</strong> ${crop.location || 'Not specified'}</div>
                            <div><i class="fas fa-calendar-alt"></i> <strong>Season:</strong> ${crop.season.charAt(0).toUpperCase() + crop.season.slice(1)}</div>
                            <div><i class="fas fa-ruler-combined"></i> <strong>Area:</strong> ${crop.area} acres</div>
                            <div><i class="fas fa-calendar-check"></i> <strong>Harvest:</strong> ${new Date(crop.expectedHarvest).toLocaleDateString()}</div>
                        </div>
                        
                        ${crop.status === 'active' ? `
                            <div class="crop-progress">
                                <div class="crop-progress-label">
                                    <span><i class="fas fa-chart-line"></i> Growth Progress</span>
                                    <span><strong>${progress}%</strong></span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" style="width: ${progress}%"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                    ${getDaysRemaining(crop.expectedHarvest)} days remaining
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="crop-metrics">
                            <div class="metric">
                                <div class="metric-value">₹${((crop.expectedYield || 0) * (crop.expectedPrice || 0)).toLocaleString('en-IN')}</div>
                                <div class="metric-label">Expected Revenue</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${yieldPerAcre}t</div>
                                <div class="metric-label">Yield/Acre</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">₹${revenuePerAcre}</div>
                                <div class="metric-label">Revenue/Acre</div>
                            </div>
                        </div>
                        
                        ${getWeatherAlert(crop) ? `
                            <div class="crop-weather-alert">
                                <div style="font-size: 0.8rem; font-weight: 500; margin-bottom: 0.25rem;">
                                    <i class="fas fa-cloud-sun"></i> Weather Alert
                                </div>
                                <div style="font-size: 0.9rem;">${getWeatherAlert(crop)}</div>
                            </div>
                        ` : ''}
                        
                        ${relatedTransactions.length > 0 ? `
                            <div class="related-transactions">
                                <div style="font-size: 0.9rem; font-weight: 500; margin-bottom: 0.5rem; color: var(--accent-color); display: flex; justify-content: space-between; align-items: center;">
                                    <span><i class="fas fa-receipt"></i> Transactions (${relatedTransactions.length})</span>
                                    <button class="btn btn-secondary" style="font-size: 0.7rem; padding: 0.25rem 0.5rem;" onclick="showCropTransactions('${crop.id}')">
                                        <i class="fas fa-eye"></i> View All
                                    </button>
                                </div>
                                ${relatedTransactions.slice(0, 3).map(transaction => `
                                    <div class="transaction-item">
                                        <div>
                                            <span style="font-size: 0.8rem;">${transaction.description}</span>
                                        </div>
                                        <div class="${transaction.type === 'income' ? 'text-success' : 'text-error'}" style="font-weight: 500;">
                                            ${transaction.type === 'income' ? '+' : '-'}₹${transaction.amount.toLocaleString('en-IN')}
                                        </div>
                                    </div>
                                `).join('')}
                                ${relatedTransactions.length > 3 ? `<div style="font-size: 0.8rem; color: var(--text-secondary); text-align: center; margin-top: 0.5rem;">+${relatedTransactions.length - 3} more transactions</div>` : ''}
                                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(255, 107, 53, 0.2); font-size: 0.85rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                        <span>Profit Margin:</span>
                                        <span class="${profitMargin >= 0 ? 'text-success' : 'text-error'}" style="font-weight: 600;">${profitMargin.toFixed(1)}%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>Net Profit:</span>
                                        <span class="${totalIncome - totalExpenses >= 0 ? 'text-success' : 'text-error'}" style="font-weight: 600;">₹${(totalIncome - totalExpenses).toLocaleString('en-IN')}</span>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="crop-actions">
                            <button class="btn btn-secondary" onclick="viewCropDetails('${crop.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-primary" onclick="editCrop('${crop.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-secondary" onclick="quickAddTransaction('${crop.id}')">
                                <i class="fas fa-plus"></i> Transaction
                            </button>
                            ${crop.status === 'active' ? `
                                <button class="btn" style="background: var(--success-color); color: white;" onclick="harvestCrop('${crop.id}')">
                                    <i class="fas fa-cut"></i> Harvest
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showCropTransactions(cropId) {
            const crop = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]').find(c => c.id === cropId);
            const transactions = getRelatedTransactions(cropId);
            
            if (!crop) return;
            
            let content = `
                <div style="margin-bottom: 2rem;">
                    <h3>${getCropEmoji(crop.name)} ${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)} - Transaction History</h3>
                    <p style="color: var(--text-secondary);">All financial transactions related to this crop</p>
                </div>
            `;

            if (transactions.length === 0) {
                content += `
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-receipt" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p style="color: var(--text-secondary);">No transactions recorded for this crop yet.</p>
                        <button class="btn btn-primary" onclick="quickAddTransaction('${cropId}'); closeModal('cropTransactionsModal');">
                            <i class="fas fa-plus"></i> Add First Transaction
                        </button>
                    </div>
                `;
            } else {
                const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const netProfit = totalIncome - totalExpenses;
                
                content += `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                        <div style="text-align: center; padding: 1rem; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                            <div style="color: var(--success-color); font-size: 1.5rem; font-weight: 700;">₹${totalIncome.toLocaleString('en-IN')}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Total Income</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(244, 67, 54, 0.1); border-radius: 8px;">
                            <div style="color: var(--error-color); font-size: 1.5rem; font-weight: 700;">₹${totalExpenses.toLocaleString('en-IN')}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Total Expenses</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 8px;">
                            <div style="color: ${netProfit >= 0 ? 'var(--success-color)' : 'var(--error-color)'}; font-size: 1.5rem; font-weight: 700;">₹${netProfit.toLocaleString('en-IN')}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Net Profit</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="quickAddTransaction('${cropId}');">
                            <i class="fas fa-plus"></i> Add New Transaction
                        </button>
                    </div>
                    
                    <div class="transaction-list">
                `;
                
                transactions.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(transaction => {
                    content += `
                        <div class="transaction-card ${transaction.type}" style="margin-bottom: 1rem;">
                            <div class="transaction-header">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">${transaction.description}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${new Date(transaction.date).toLocaleDateString()} • ${transaction.paymentMethod.replace('_', ' ')}</div>
                                </div>
                                <div class="transaction-amount ${transaction.type}">
                                    ${transaction.type === 'income' ? '+' : '-'}₹${transaction.amount.toLocaleString('en-IN')}
                                </div>
                            </div>
                            ${transaction.notes ? `<div style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">${transaction.notes}</div>` : ''}
                        </div>
                    `;
                });
                
                content += '</div>';
            }

            // Create and show modal
            const modal = document.createElement('div');
            modal.id = 'cropTransactionsModal';
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">
                            <i class="fas fa-receipt"></i> Transaction History
                        </h2>
                        <button class="close-modal" onclick="closeModal('cropTransactionsModal')">&times;</button>
                    </div>
                    ${content}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getCropImage(cropName) {
            const images = {
                rice: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400&h=300&fit=crop&auto=format&q=60',
                wheat: 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?w=400&h=300&fit=crop&auto=format&q=60',
                corn: 'https://images.unsplash.com/photo-1551754655-cd27e38d2076?w=400&h=300&fit=crop&auto=format&q=60',
                cotton: 'https://images.unsplash.com/photo-1592085189859-b372d7d7d1d6?w=400&h=300&fit=crop&auto=format&q=60',
                sugarcane: 'https://images.unsplash.com/photo-1571115764595-644a1f56a55c?w=400&h=300&fit=crop&auto=format&q=60',
                vegetables: 'https://images.unsplash.com/photo-1566385101042-1a0aa0c1268c?w=400&h=300&fit=crop&auto=format&q=60',
                fruits: 'https://images.unsplash.com/photo-1610832958506-aa56368176cf?w=400&h=300&fit=crop&auto=format&q=60',
                spices: 'https://images.unsplash.com/photo-1596040033229-a9821ebd058d?w=400&h=300&fit=crop&auto=format&q=60',
                oilseeds: 'https://images.unsplash.com/photo-1552459062-5662a1d7c7e5?w=400&h=300&fit=crop&auto=format&q=60'
            };
            return images[cropName] || 'https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=400&h=300&fit=crop&auto=format&q=60';
        }

        function getCropEmoji(cropName) {
            const emojis = {
                rice: '🌾',
                wheat: '🌾',
                corn: '🌽',
                cotton: '🌿',
                sugarcane: '🎋',
                pulses: '🫘',
                vegetables: '🥕',
                fruits: '🍎',
                spices: '🌶️',
                oilseeds: '🌻'
            };
            return emojis[cropName] || '🌱';
        }

        function updateCropVarieties() {
            const cropName = document.getElementById('cropName').value;
            const varietySelect = document.getElementById('cropVariety');
            
            varietySelect.innerHTML = '<option value="">Select Variety</option>';
            
            if (cropName && CROP_VARIETIES[cropName]) {
                CROP_VARIETIES[cropName].forEach(variety => {
                    const option = document.createElement('option');
                    option.value = variety;
                    option.textContent = variety;
                    varietySelect.appendChild(option);
                });
            }
        }

        function calculateHarvestDate() {
            const sowingDate = document.getElementById('sowingDate').value;
            if (!sowingDate) return;
            
            const cropName = document.getElementById('cropName').value;
            const season = document.getElementById('cropSeason').value;
            
            // Typical crop durations (in days)
            const cropDurations = {
                rice: { kharif: 120, rabi: 150 },
                wheat: { rabi: 120, zaid: 110 },
                corn: { kharif: 90, rabi: 80, zaid: 85 },
                cotton: { kharif: 180 },
                sugarcane: { perennial: 365 },
                pulses: { kharif: 90, rabi: 100 },
                vegetables: { kharif: 60, rabi: 70, zaid: 50 },
                fruits: { perennial: 365 },
                spices: { kharif: 150, rabi: 120 },
                oilseeds: { kharif: 100, rabi: 110 }
            };
            
            let duration = 90; // default
            if (cropName && season && cropDurations[cropName] && cropDurations[cropName][season]) {
                duration = cropDurations[cropName][season];
            }
            
            const sowing = new Date(sowingDate);
            const harvest = new Date(sowing.getTime() + (duration * 24 * 60 * 60 * 1000));
            
            document.getElementById('expectedHarvest').value = harvest.toISOString().split('T')[0];
            calculateExpectedRevenue();
        }

        function calculateExpectedRevenue() {
            const area = parseFloat(document.getElementById('cropArea').value) || 0;
            const yield_ = parseFloat(document.getElementById('expectedYield').value) || 0;
            const price = parseFloat(document.getElementById('expectedPrice').value) || 0;
            
            const revenue = area * yield_ * price;
            document.getElementById('expectedRevenue').textContent = `₹${revenue.toLocaleString('en-IN')}`;
        }

        function calculateCropProgress(crop) {
            if (crop.status !== 'active') return 100;
            
            const sowingDate = new Date(crop.sowingDate);
            const harvestDate = new Date(crop.expectedHarvest);
            const today = new Date();
            
            const totalDays = (harvestDate - sowingDate) / (1000 * 60 * 60 * 24);
            const daysPassed = (today - sowingDate) / (1000 * 60 * 60 * 24);
            
            const progress = Math.min(Math.max((daysPassed / totalDays) * 100, 0), 100);
            return Math.round(progress);
        }

        function getDaysRemaining(harvestDate) {
            const today = new Date();
            const harvest = new Date(harvestDate);
            const daysRemaining = Math.ceil((harvest - today) / (1000 * 60 * 60 * 24));
            return Math.max(daysRemaining, 0);
        }

        function getWeatherAlert(crop) {
            const alerts = [
                'Favorable conditions for growth',
                'Light rain expected - good for irrigation',
                'High temperature - monitor water levels',
                'Perfect humidity for this crop'
            ];
            return alerts[Math.floor(Math.random() * alerts.length)];
        }

        function getRelatedTransactions(cropId) {
            const transactions = JSON.parse(localStorage.getItem(STORAGE_KEYS.TRANSACTIONS) || '[]');
            return transactions.filter(t => t.cropId === cropId);
        }

        function quickAddTransaction(cropId) {
            showAddTransactionModal();
            document.getElementById('transactionCropId').value = cropId;
        }

        function filterCrops() {
            const statusFilter = document.getElementById('cropStatusFilter').value;
            const seasonFilter = document.getElementById('cropSeasonFilter').value;
            const searchFilter = document.getElementById('cropSearchFilter').value.toLowerCase();
            
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            
            const filteredCrops = crops.filter(crop => {
                const matchesStatus = !statusFilter || crop.status === statusFilter;
                const matchesSeason = !seasonFilter || crop.season === seasonFilter;
                const matchesSearch = !searchFilter || 
                    crop.name.toLowerCase().includes(searchFilter) ||
                    (crop.variety && crop.variety.toLowerCase().includes(searchFilter)) ||
                    (crop.location && crop.location.toLowerCase().includes(searchFilter));
                
                return matchesStatus && matchesSeason && matchesSearch;
            });
            
            displayCrops(filteredCrops);
        }

        function clearCropFilters() {
            document.getElementById('cropStatusFilter').value = '';
            document.getElementById('cropSeasonFilter').value = '';
            document.getElementById('cropSearchFilter').value = '';
            loadCrops();
        }

        function showAddCropModal() {
            document.getElementById('addCropModal').classList.add('active');
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sowingDate').value = today;
            
            // Clear form
            document.getElementById('addCropForm').reset();
            document.getElementById('sowingDate').value = today;
            calculateHarvestDate();
        }

        function handleAddCrop(e) {
            e.preventDefault();
            
            const isEditing = document.getElementById('addCropForm').dataset.editingId;
            const cropData = {
                id: isEditing || Date.now().toString(),
                name: document.getElementById('cropName').value,
                variety: document.getElementById('cropVariety').value,
                area: parseFloat(document.getElementById('cropArea').value),
                season: document.getElementById('cropSeason').value,
                location: document.getElementById('cropLocation').value,
                sowingDate: document.getElementById('sowingDate').value,
                expectedHarvest: document.getElementById('expectedHarvest').value,
                expectedYield: parseFloat(document.getElementById('expectedYield').value) || 0,
                expectedPrice: parseFloat(document.getElementById('expectedPrice').value) || 0,
                notes: document.getElementById('cropNotes').value,
                status: 'active',
                image: getCropImage(document.getElementById('cropName').value),
                createdAt: isEditing ? undefined : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            let crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            
            if (isEditing) {
                const index = crops.findIndex(c => c.id === isEditing);
                if (index !== -1) {
                    crops[index] = { ...crops[index], ...cropData };
                }
            } else {
                crops.push(cropData);
            }
            
            localStorage.setItem(STORAGE_KEYS.CROPS, JSON.stringify(crops));
            
            // Save to Firestore if user is authenticated
            if (currentUser && currentUser.uid) {
                db.collection('crops').doc(cropData.id).set({
                    ...cropData,
                    userId: currentUser.uid
                }).catch(error => console.error('Error saving to Firestore:', error));
            }
            
            loadCrops();
            updateDashboardStats();
            closeModal('addCropModal');
            document.getElementById('addCropForm').reset();
            delete document.getElementById('addCropForm').dataset.editingId;
            
            showNotification(
                isEditing ? 'Crop updated successfully! 🌱' : 'New crop added successfully! 🌱', 
                'success'
            );
            autoSaveData();
        }

        function editCrop(cropId) {
            const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
            const crop = crops.find(c => c.id === cropId);
            if (!crop) return;
            
            // Populate form with crop data
            document.getElementById('cropName').value = crop.name;
            updateCropVarieties();
            setTimeout(() => {
                document.getElementById('cropVariety').value = crop.variety || '';
            }, 100);
            document.getElementById('cropArea').value = crop.area;
            document.getElementById('cropSeason').value = crop.season;
            document.getElementById('cropLocation').value = crop.location || '';
            document.getElementById('sowingDate').value = crop.sowingDate;
            document.getElementById('expectedHarvest').value = crop.expectedHarvest;
            document.getElementById('expectedYield').value = crop.expectedYield || '';
            document.getElementById('expectedPrice').value = crop.expectedPrice || '';
            document.getElementById('cropNotes').value = crop.notes || '';
            
            // Calculate expected revenue
            setTimeout(calculateExpectedRevenue, 200);
            
            // Change form to edit mode
            document.querySelector('#addCropModal .modal-title').innerHTML = '<i class="fas fa-edit"></i> ' + translate('editCrop');
            document.querySelector('#addCropForm button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> ' + translate('updateCrop');
            
            // Store crop ID for update
            document.getElementById('addCropForm')
          function editCrop(cropId) {
    const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
    const crop = crops.find(c => c.id === cropId);
    if (!crop) return;
    
    // Populate form with crop data
    document.getElementById('cropName').value = crop.name;
    updateCropVarieties();
    setTimeout(() => {
        document.getElementById('cropVariety').value = crop.variety || '';
    }, 100);
    document.getElementById('cropArea').value = crop.area;
    document.getElementById('cropSeason').value = crop.season;
    document.getElementById('cropLocation').value = crop.location || '';
    document.getElementById('sowingDate').value = crop.sowingDate;
    document.getElementById('expectedHarvest').value = crop.expectedHarvest;
    document.getElementById('expectedYield').value = crop.expectedYield || '';
    document.getElementById('expectedPrice').value = crop.expectedPrice || '';
    document.getElementById('cropNotes').value = crop.notes || '';
    
    // Calculate expected revenue
    setTimeout(calculateExpectedRevenue, 200);
    
    // Change form to edit mode
    document.querySelector('#addCropModal .modal-title').innerHTML = '<i class="fas fa-edit"></i> Edit Crop';
    document.querySelector('#addCropForm button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Update Crop';
    
    // Store crop ID for update
    document.getElementById('addCropForm').dataset.editingId = cropId;
    
    // Show the modal
    document.getElementById('addCropModal').classList.add('active');
}

function harvestCrop(cropId) {
    if (confirm('Mark this crop as harvested? This will move it to completed crops.')) {
        let crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
        const cropIndex = crops.findIndex(c => c.id === cropId);
        
        if (cropIndex !== -1) {
            crops[cropIndex].status = 'harvested';
            crops[cropIndex].actualHarvestDate = new Date().toISOString().split('T')[0];
            localStorage.setItem(STORAGE_KEYS.CROPS, JSON.stringify(crops));
            
            loadCrops();
            updateDashboardStats();
            showNotification('Crop marked as harvested! 🌾', 'success');
            autoSaveData();
        }
    }
}

function viewCropDetails(cropId) {
    const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
    const crop = crops.find(c => c.id === cropId);
    if (!crop) return;
    
    const progress = calculateCropProgress(crop);
    const relatedTransactions = getRelatedTransactions(cropId);
    
    const modalContent = `
        <div class="crop-details">
            <div style="text-align: center; margin-bottom: 2rem;">
                <img src="${crop.image || getCropImage(crop.name)}" alt="${crop.name}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 12px;">
                <h2 style="margin-top: 1rem;">${getCropEmoji(crop.name)} ${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)}</h2>
                <div class="badge ${crop.status === 'active' ? 'bg-success' : 'bg-warning'}" style="margin: 0.5rem 0;">
                    ${crop.status.charAt(0).toUpperCase() + crop.status.slice(1)}
                </div>
            </div>
            
            <div class="grid grid-2 gap-2" style="margin-bottom: 2rem;">
                <div class="detail-item">
                    <div style="font-size: 0.9rem; color: var(--text-secondary);">Variety</div>
                    <div style="font-weight: 600;">${crop.variety || 'Not specified'}</div>
                </div>
                <div class="detail-item">
                    <div style="font-size: 0.9rem; color: var(--text-secondary);">Area</div>
                    <div style="font-weight: 600;">${crop.area} acres</div>
                </div>
                <div class="detail-item">
                    <div style="font-size: 0.9rem; color: var(--text-secondary);">Season</div>
                    <div style="font-weight: 600;">${crop.season.charAt(0).toUpperCase() + crop.season.slice(1)}</div>
                </div>
                <div class="detail-item">
                    <div style="font-size: 0.9rem; color: var(--text-secondary);">Location</div>
                    <div style="font-weight: 600;">${crop.location || 'Not specified'}</div>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <i class="fas fa-calendar"></i> Timeline
                </h3>
                <div class="timeline">
                    <div class="timeline-item">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Sowing Date</div>
                        <div style="font-weight: 600;">${new Date(crop.sowingDate).toLocaleDateString()}</div>
                    </div>
                    <div class="timeline-item">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Expected Harvest</div>
                        <div style="font-weight: 600;">${new Date(crop.expectedHarvest).toLocaleDateString()}</div>
                    </div>
                    ${crop.actualHarvestDate ? `
                    <div class="timeline-item">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Actual Harvest</div>
                        <div style="font-weight: 600;">${new Date(crop.actualHarvestDate).toLocaleDateString()}</div>
                    </div>
                    ` : ''}
                </div>
            </div>
            
            ${crop.status === 'active' ? `
            <div style="margin-bottom: 2rem;">
                <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <i class="fas fa-chart-line"></i> Growth Progress
                </h3>
                <div class="progress" style="height: 20px; margin-bottom: 0.5rem;">
                    <div class="progress-bar" style="width: ${progress}%"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                    <span>${progress}% Complete</span>
                    <span>${getDaysRemaining(crop.expectedHarvest)} days remaining</span>
                </div>
            </div>
            ` : ''}
            
            <div style="margin-bottom: 2rem;">
                <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <i class="fas fa-calculator"></i> Financials
                </h3>
                <div class="grid grid-2 gap-2">
                    <div class="financial-item">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Expected Yield</div>
                        <div style="font-weight: 600;">${crop.expectedYield || 0} tons</div>
                    </div>
                    <div class="financial-item">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Expected Price</div>
                        <div style="font-weight: 600;">₹${(crop.expectedPrice || 0).toLocaleString('en-IN')}/ton</div>
                    </div>
                    <div class="financial-item">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Expected Revenue</div>
                        <div style="font-weight: 600; color: var(--success-color);">
                            ₹${((crop.expectedYield || 0) * (crop.expectedPrice || 0)).toLocaleString('en-IN')}
                        </div>
                    </div>
                    <div class="financial-item">
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Revenue/Acre</div>
                        <div style="font-weight: 600;">
                            ₹${(crop.area > 0 ? ((crop.expectedYield || 0) * (crop.expectedPrice || 0) / crop.area).toLocaleString('en-IN') : 0)}
                        </div>
                    </div>
                </div>
            </div>
            
            ${relatedTransactions.length > 0 ? `
            <div style="margin-bottom: 2rem;">
                <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <i class="fas fa-receipt"></i> Transactions (${relatedTransactions.length})
                </h3>
                <div style="max-height: 200px; overflow-y: auto;">
                    ${relatedTransactions.map(transaction => `
                        <div class="transaction-summary">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600;">${transaction.description}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">
                                        ${new Date(transaction.date).toLocaleDateString()}
                                    </div>
                                </div>
                                <div class="${transaction.type === 'income' ? 'text-success' : 'text-error'}" style="font-weight: 600;">
                                    ${transaction.type === 'income' ? '+' : '-'}₹${transaction.amount.toLocaleString('en-IN')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            ${crop.notes ? `
            <div style="margin-bottom: 2rem;">
                <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <i class="fas fa-sticky-note"></i> Notes
                </h3>
                <div style="padding: 1rem; background: rgba(46, 125, 50, 0.05); border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    ${crop.notes}
                </div>
            </div>
            ` : ''}
            
            <div class="flex gap-2">
                <button class="btn btn-primary" onclick="editCrop('${cropId}'); closeModal('cropDetailsModal');">
                    <i class="fas fa-edit"></i> Edit Crop
                </button>
                <button class="btn btn-secondary" onclick="closeModal('cropDetailsModal')">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    `;
    
    // Create and show modal
    const modal = document.createElement('div');
    modal.id = 'cropDetailsModal';
    modal.className = 'modal active';
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-seedling"></i> Crop Details
                </h2>
                <button class="close-modal" onclick="closeModal('cropDetailsModal')">&times;</button>
            </div>
            ${modalContent}
        </div>
    `;
    document.body.appendChild(modal);
}

function showCropAnalytics() {
    const crops = JSON.parse(localStorage.getItem(STORAGE_KEYS.CROPS) || '[]');
    const transactions = JSON.parse(localStorage.getItem(STORAGE_KEYS.TRANSACTIONS) || '[]');
    
    if (crops.length === 0) {
        showNotification('No crops available for analytics', 'warning');
        return;
    }
    
    // Calculate crop performance metrics
    const cropPerformance = crops.map(crop => {
        const cropTransactions = transactions.filter(t => t.cropId === crop.id);
        const expenses = cropTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        const income = cropTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
        const profit = income - expenses;
        const roi = expenses > 0 ? (profit / expenses) * 100 : 0;
        
        return {
            name: crop.name,
            variety: crop.variety,
            area: crop.area,
            expenses,
            income,
            profit,
            roi,
            status: crop.status
        };
    });
    
    const modalContent = `
        <div class="crop-analytics">
            <h3 style="margin-bottom: 2rem; text-align: center;">
                <i class="fas fa-chart-pie"></i> Crop Performance Analytics
            </h3>
            
            <div class="dashboard-grid" style="margin-bottom: 2rem;">
                <div class="card stat-card">
                    <i class="fas fa-seedling stat-icon text-primary"></i>
                    <div class="stat-value">${crops.length}</div>
                    <div class="stat-label">Total Crops</div>
                </div>
                <div class="card stat-card">
                    <i class="fas fa-chart-line stat-icon text-success"></i>
                    <div class="stat-value">₹${cropPerformance.reduce((sum, c) => sum + c.income, 0).toLocaleString('en-IN')}</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                <div class="card stat-card">
                    <i class="fas fa-money-bill-wave stat-icon text-warning"></i>
                    <div class="stat-value">₹${cropPerformance.reduce((sum, c) => sum + c.expenses, 0).toLocaleString('en-IN')}</div>
                    <div class="stat-label">Total Investment</div>
                </div>
                <div class="card stat-card">
                    <i class="fas fa-coins stat-icon text-info"></i>
                    <div class="stat-value">₹${cropPerformance.reduce((sum, c) => sum + c.profit, 0).toLocaleString('en-IN')}</div>
                    <div class="stat-label">Net Profit</div>
                </div>
            </div>
            
            <div class="card" style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-trophy"></i> Top Performing Crops by ROI
                </h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Crop</th>
                                <th>Variety</th>
                                <th>Area (acres)</th>
                                <th>Investment</th>
                                <th>Revenue</th>
                                <th>Profit</th>
                                <th>ROI</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cropPerformance
                                .filter(c => c.roi > 0)
                                .sort((a, b) => b.roi - a.roi)
                                .slice(0, 5)
                                .map(crop => `
                                <tr>
                                    <td>${crop.name.charAt(0).toUpperCase() + crop.name.slice(1)}</td>
                                    <td>${crop.variety || 'N/A'}</td>
                                    <td>${crop.area}</td>
                                    <td>₹${crop.expenses.toLocaleString('en-IN')}</td>
                                    <td>₹${crop.income.toLocaleString('en-IN')}</td>
                                    <td class="${crop.profit >= 0 ? 'text-success' : 'text-error'}">
                                        ₹${Math.abs(crop.profit).toLocaleString('en-IN')}
                                    </td>
                                    <td class="${crop.roi >= 0 ? 'text-success' : 'text-error'}">
                                        ${crop.roi.toFixed(1)}%
                                    </td>
                                </tr>
                                `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="grid grid-2 gap-2">
                <div class="card">
                    <h3 style="margin-bottom: 1.5rem;">
                        <i class="fas fa-chart-pie"></i> Crop Distribution by Area
                    </h3>
                    <div class="chart-container">
                        <canvas id="cropAreaChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 1.5rem;">
                        <i class="fas fa-chart-bar"></i> Profitability by Crop
                    </h3>
                    <div class="chart-container">
                        <canvas id="cropProfitChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="flex-center" style="margin-top: 2rem;">
                <button class="btn btn-primary" onclick="exportCropAnalytics()">
                    <i class="fas fa-download"></i> Export Report
                </button>
            </div>
        </div>
    `;
    
    // Create and show modal
    const modal = document.createElement('div');
    modal.id = 'cropAnalyticsModal';
    modal.className = 'modal active';
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-chart-line"></i> Crop Analytics
                </h2>
                <button class="close-modal" onclick="closeModal('cropAnalyticsModal')">&times;</button>
            </div>
            ${modalContent}
        </div>
    `;
    document.body.appendChild(modal);
    
    // Initialize charts
    setTimeout(() => {
        initializeCropAnalyticsCharts(cropPerformance);
    }, 100);
}

function initializeCropAnalyticsCharts(cropPerformance) {
    // Crop Area Distribution Chart
    const areaCtx = document.getElementById('cropAreaChart').getContext('2d');
    const cropAreaData = {};
    
    cropPerformance.forEach(crop => {
        cropAreaData[crop.name] = (cropAreaData[crop.name] || 0) + crop.area;
    });
    
    new Chart(areaCtx, {
        type: 'pie',
        data: {
            labels: Object.keys(cropAreaData),
            datasets: [{
                data: Object.values(cropAreaData),
                backgroundColor: [
                    '#4CAF50', '#2196F3', '#FF9800', '#E91E63', '#9C27B0',
                    '#FF5722', '#607D8B', '#795548', '#3F51B5', '#009688'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right'
                },
                title: {
                    display: true,
                    text: 'Area Distribution (acres)'
                }
            }
        }
    });
    
    // Crop Profitability Chart
    const profitCtx = document.getElementById('cropProfitChart').getContext('2d');
    const cropProfitData = {};
    
    cropPerformance.forEach(crop => {
        if (!cropProfitData[crop.name]) {
            cropProfitData[crop.name] = 0;
        }
        cropProfitData[crop.name] += crop.profit;
    });
    
    new Chart(profitCtx, {
        type: 'bar',
        data: {
            labels: Object.keys(cropProfitData),
            datasets: [{
                label: 'Net Profit (₹)',
                data: Object.values(cropProfitData),
                backgroundColor: Object.values(cropProfitData).map(profit => 
                    profit >= 0 ? '#4CAF50' : '#F44336'
                )
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Profit by Crop Type'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Indian Rupees (₹)'
                    }
                }
            }
        }
    });
}

function exportCropAnalytics() {
    // This would typically generate a PDF or Excel report
    showNotification('Crop analytics report exported successfully!', 'success');
}

// Close modal function
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        setTimeout(() => {
            if (modal.parentNode) {
                modal.parentNode.removeChild(modal);
            }
        }, 300);
    }
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});
          </script>
</html>
          
